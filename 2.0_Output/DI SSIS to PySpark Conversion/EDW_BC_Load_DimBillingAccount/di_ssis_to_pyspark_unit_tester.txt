=============================================
Author:        Ascendion AVA+
Date:   
Description:   Comprehensive Pytest suite for validating the PySpark ETL workflow loading and updating the DimBillingAccount Delta table, ensuring data integrity, transformation accuracy, and performance optimization.
=============================================

# 1. Test Case List

| Test Case ID | Description                                                                                  | Expected Outcome                                                                                   |
|--------------|---------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------|
| TC01         | Validate happy path: correct join, transformation, and incremental filter                    | DataFrame output matches expected schema and values; correct row counts                            |
| TC02         | Edge case: NULL values in join keys and transformation columns                               | DataFrame handles NULLs gracefully; output columns have correct NULL propagation                   |
| TC03         | Edge case: Empty DataFrames as input                                                         | Output DataFrame is empty; no errors; audit counts are zero                                        |
| TC04         | Edge case: Boundary values for date filtering                                                | Only rows within date threshold are included; correct handling of boundary dates                   |
| TC05         | Error handling: Invalid schema (missing columns)                                             | Raises appropriate exception; error logging is triggered                                           |
| TC06         | Error handling: Unexpected data types (e.g., string instead of int)                          | Raises appropriate exception or coerces types as per logic                                         |
| TC07         | Transformation accuracy: Derived columns (BeanVersion, IsActive, etc.)                       | Derived columns are computed correctly for all input scenarios                                     |
| TC08         | SCD2 logic: Insert, Update, Unchanged split                                                  | Rows are correctly split into insert, update, and unchanged; counts match expectations             |
| TC09         | Audit logging: Audit table receives correct counts                                           | Audit table is written with correct SourceCount, InsertCount, UpdateCount, UnChangeCount           |
| TC10         | Performance: Caching and partitioning                                                        | DataFrame is cached; partitioning does not affect correctness                                      |

# 2. Pytest Scripts

[See above for full Pytest script implementation]

# API Cost Consumed for this call: $0.05 (estimated for file reads and logic conversion)