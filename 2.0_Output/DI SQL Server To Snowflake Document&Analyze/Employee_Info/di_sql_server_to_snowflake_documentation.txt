=============================================
Author: Ascendion AVA+
Created on: 
Description: Production-ready T-SQL script to create or recreate a backup copy of Employee master data for troubleshooting, comparison, and recovery.
=============================================

1. Overview of Program:
This SQL Server script creates (or recreates) a backup table of the Employee master data, keyed by EmployeeNo, to support ad-hoc troubleshooting, point-in-time comparison, and recovery scenarios. The script ensures that the backup table, dbo.employee_bkup, contains a snapshot of current employee details and their net pay by joining the Employee and Salary tables. This aligns with enterprise data warehousing and analytics by enabling historical data preservation, supporting data audits, and facilitating root-cause analysis for HR and payroll operations. The business problem addressed is the need for reliable, restorable snapshots of employee data, which benefits the organization by ensuring data consistency, supporting compliance, and enabling rapid recovery from data issues. The script uses SQL Server objects such as tables (Employee, Salary, employee_bkup), joins, and error handling constructs, and is designed for production environments.

2. Code Structure and Design:
- The script is organized into clear sections for pre-execution and post-execution checklists, table creation, data population, and error handling.
- DDL: Uses CREATE TABLE and DROP TABLE to manage the backup table.
- DML: Uses INSERT INTO ... SELECT to populate the backup table.
- Joins: INNER JOIN between Employee and Salary on EmployeeNo.
- Indexing: EmployeeNo is the PRIMARY KEY in the backup table.
- SQL Server Components Used:
  - Tables: dbo.Employee, dbo.Salary, dbo.employee_bkup
  - Joins: INNER JOIN
  - Aggregations: None
  - Temporary Tables: None (uses a permanent backup table)
  - Subqueries: Used in IF EXISTS check
  - CTEs/Window Functions: None
- Error Handling: TRY...CATCH block with THROW for error relay.
- Performance: SET NOCOUNT ON to suppress extra messages; table is dropped and recreated for a clean state.
- No third-party integrations or external dependencies.

3. Data Flow and Processing Logic:
- The script first checks for the existence of the backup table and drops it if present.
- It creates dbo.employee_bkup with columns EmployeeNo, FirstName, LastName, DepartmentNo, and NetPay.
- If dbo.Employee contains data, it populates dbo.employee_bkup by joining dbo.Employee and dbo.Salary on EmployeeNo, selecting relevant fields.
- If dbo.Employee is empty, the backup table is dropped to avoid retaining an empty structure.
- Data flows from dbo.Employee and dbo.Salary into dbo.employee_bkup, with EmployeeNo as the primary key.
- Transformations: Direct field mapping, with NetPay sourced from Salary.

4. Data Mapping:
Target Table Name | Target Column Name | Source Table Name | Source Column Name | Remarks
employee_bkup    | EmployeeNo         | Employee          | EmployeeNo         | 1 to 1 mapping (Primary Key)
employee_bkup    | FirstName          | Employee          | FirstName          | 1 to 1 mapping
employee_bkup    | LastName           | Employee          | LastName           | 1 to 1 mapping
employee_bkup    | DepartmentNo       | Employee          | DepartmentNo       | 1 to 1 mapping
employee_bkup    | NetPay             | Salary            | NetPay             | 1 to 1 mapping (joined on EmployeeNo)

5. Complexity Analysis:
- Lines of Code: ~60 (including comments and checklists)
- Number of Tables Referenced: 3 (Employee, Salary, employee_bkup)
- Types of Joins Used: INNER JOIN
- Temporary Tables, Table Variables, CTEs: None
- Aggregate Functions: None
- DML Statements: SELECT, INSERT, DROP TABLE, CREATE TABLE
- Conditional Logic: IF EXISTS, IF OBJECT_ID, TRY...CATCH
- Performance Considerations: Table is dropped and recreated for consistency; SET NOCOUNT ON reduces message overhead; primary key on backup table for fast lookups.
- Data Volume Handling: Processes all rows in Employee and Salary; volume depends on source tables.
- External Dependencies: None (self-contained script)
- Overall Complexity Score: 35/100 (Moderate; standard backup logic with robust error handling and basic conditional logic)

6. Key Outputs:
- The final output is the dbo.employee_bkup table, a permanent table containing a snapshot of employee and salary data at the time of script execution.
- This backup table can be used for reporting, point-in-time comparison, and recovery.
- Output aligns with business goals by providing a reliable backup for HR/payroll data integrity and auditability.
- Storage Format: Permanent SQL Server table (dbo.employee_bkup).

apiCost: 0.0076 USD