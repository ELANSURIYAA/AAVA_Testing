=============================================
Author:        Ascendion AVA+
Created on:   
Description:   Snowflake-compatible script to create and populate a backup copy of Employee master data for troubleshooting, comparison, and recovery.
============================================

-- Snowflake-Compatible Query:
--------------------------------------------------------------------------------
-- Snowflake Script: Create and Populate Employee Backup Table
-- This script creates (or recreates) a backup table 'employee_bkup' keyed by EmployeeNo,
-- and populates it from Employee and Salary tables for point-in-time comparison and recovery.
--------------------------------------------------------------------------------

-- Drop the backup table if it exists
DROP TABLE IF EXISTS employee_bkup;

-- Create the backup table with mapped data types
CREATE TABLE employee_bkup (
    EmployeeNo   INT         NOT NULL PRIMARY KEY,   -- Unique Primary Index
    FirstName    STRING      NOT NULL,
    LastName     STRING      NOT NULL,
    DepartmentNo SMALLINT,
    NetPay       INT
);

-- Populate the backup table if Employee table has rows
-- Snowflake does not support IF EXISTS in SQL, so use a conditional scripting block
-- Note: Snowflake scripting uses BEGIN ... END blocks and variables

DECLARE employee_count INT;

BEGIN
    -- Count rows in Employee table
    SELECT COUNT(*) INTO :employee_count FROM Employee;

    IF employee_count > 0 THEN
        -- Insert data into backup table
        INSERT INTO employee_bkup (EmployeeNo, FirstName, LastName, DepartmentNo, NetPay)
        SELECT  e.EmployeeNo,
                e.FirstName,
                e.LastName,
                e.DepartmentNo,
                s.NetPay
        FROM    Employee AS e
        INNER JOIN Salary AS s
            ON e.EmployeeNo = s.EmployeeNo;
    ELSE
        -- Drop the backup table if no rows found
        DROP TABLE IF EXISTS employee_bkup;
    END IF;
END;

-- Optional: Update statistics is not required in Snowflake; clustering can be considered for performance.
-- Consider retention and purge policy for backup tables as per Snowflake best practices.

API Cost Calculations
apiCost: 0.002 USD