=============================================
Author:        Ascendion AVA+
Created on:   
Description:   Snowflake-compatible script to create and populate a backup copy of Employee master data for troubleshooting and recovery.
============================================

-- Snowflake-Compatible Query:

-- Drop the backup table if it exists
DROP TABLE IF EXISTS employee_bkup;

-- Create the backup table
CREATE TABLE employee_bkup (
    EmployeeNo INT NOT NULL PRIMARY KEY,
    FirstName STRING NOT NULL,
    LastName STRING NOT NULL,
    DepartmentNo SMALLINT,
    NetPay INT
);

-- Populate the backup table if Employee table has rows
-- Note: Snowflake does not support IF EXISTS in the same way as SQL Server,
-- so we use a multi-step approach with scripting.

-- Check for rows and populate or drop table accordingly
-- Snowflake scripting block
BEGIN
    -- Count rows in Employee table
    DECLARE employee_count INT;
    SELECT COUNT(*) INTO :employee_count FROM Employee;

    IF employee_count > 0 THEN
        INSERT INTO employee_bkup (EmployeeNo, FirstName, LastName, DepartmentNo, NetPay)
        SELECT e.EmployeeNo,
               e.FirstName,
               e.LastName,
               e.DepartmentNo,
               s.NetPay
        FROM Employee AS e
        INNER JOIN Salary AS s
            ON e.EmployeeNo = s.EmployeeNo;
    ELSE
        DROP TABLE IF EXISTS employee_bkup;
    END IF;
END;

-- Error handling in Snowflake scripting is done via TRY...CATCH blocks,
-- but for this use-case, the above block suffices for control flow.

-- Comments:
-- - Data types mapped: CHAR(30) → STRING, INT → INT, SMALLINT → SMALLINT.
-- - PRIMARY KEY constraint is included for compatibility, but Snowflake does not enforce PKs.
-- - The script uses Snowflake scripting (BEGIN...END) for procedural logic.
-- - No explicit transaction handling required unless multiple DML statements are grouped.

API Cost Calculations
apiCost: 0.0025 USD