<?xml version="1.0" encoding="UTF-8"?>
<POWERMAP version="1.0">
  <REPOSITORY NAME="DQ_MappingRepo" VERSION="1.0"/>
  <FOLDER NAME="DQ_VALIDATION" GROUP="ETL" DESCRIPTION="DQ validation for MEMBERSDATA" OWNER="Ascendion AVA+">
    <SOURCE NAME="MEMBERSDATA" DATABASETYPE="Flat File">
      <FIELD NAME="FIRSTNAME" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="LASTNAME" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="COMPANY" DATATYPE="string" LENGTH="255"/>
      <FIELD NAME="ADDRESS" DATATYPE="string" LENGTH="16777216"/>
      <FIELD NAME="CITY" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="COUNTRY" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="STATE" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="ZIP" DATATYPE="string" LENGTH="20"/>
      <FIELD NAME="PHONENUMBER1" DATATYPE="string" LENGTH="50"/>
      <FIELD NAME="PHONENUMBER2" DATATYPE="string" LENGTH="50"/>
      <FIELD NAME="EMAIL" DATATYPE="string" LENGTH="255"/>
      <FIELD NAME="WEB" DATATYPE="string" LENGTH="255"/>
      <FIELD NAME="MEMBER_ID" DATATYPE="integer" PRECISION="8"/>
    </SOURCE>

    <TRANSFORMATION NAME="DQ_Expression" TYPE="Expression" DESCRIPTION="DQ Rule Checks">
      <FIELD NAME="FIRSTNAME" EXPRESSION="FIRSTNAME"/>
      <FIELD NAME="DQ_FIRSTNAME_NOTNULL" EXPRESSION="IIF(ISNULL(FIRSTNAME), 0, 1)"/>
      <FIELD NAME="LASTNAME" EXPRESSION="LASTNAME"/>
      <FIELD NAME="DQ_LASTNAME_NOTNULL" EXPRESSION="IIF(ISNULL(LASTNAME), 0, 1)"/>
      <FIELD NAME="COMPANY" EXPRESSION="COMPANY"/>
      <FIELD NAME="DQ_COMPANY_LEN" EXPRESSION="IIF(LEN(COMPANY) &lt;= 255, 1, 0)"/>
      <FIELD NAME="ADDRESS" EXPRESSION="ADDRESS"/>
      <FIELD NAME="DQ_ADDRESS_LEN" EXPRESSION="IIF(LEN(ADDRESS) &lt;= 16777216, 1, 0)"/>
      <FIELD NAME="CITY" EXPRESSION="CITY"/>
      <FIELD NAME="DQ_CITY_VALUE" EXPRESSION="IIF(CITY IN ('Los Angeles', 'New York', 'London'), 1, 0)"/>
      <FIELD NAME="COUNTRY" EXPRESSION="COUNTRY"/>
      <FIELD NAME="DQ_COUNTRY_NOTNULL" EXPRESSION="IIF(ISNULL(COUNTRY), 0, 1)"/>
      <FIELD NAME="STATE" EXPRESSION="STATE"/>
      <FIELD NAME="DQ_STATE_LEN" EXPRESSION="IIF(LEN(STATE) &lt;= 100, 1, 0)"/>
      <FIELD NAME="ZIP" EXPRESSION="ZIP"/>
      <FIELD NAME="DQ_ZIP_FORMAT" EXPRESSION="IIF(REG_MATCH(ZIP, '^[A-Za-z0-9-]{5,10}$'), 1, 0)"/>
      <FIELD NAME="PHONENUMBER1" EXPRESSION="PHONENUMBER1"/>
      <FIELD NAME="DQ_PHONENUMBER1_NOTNULL" EXPRESSION="IIF(ISNULL(PHONENUMBER1), 0, 1)"/>
      <FIELD NAME="PHONENUMBER2" EXPRESSION="PHONENUMBER2"/>
      <FIELD NAME="DQ_PHONENUMBER2_DISTINCT" EXPRESSION="IIF(PHONENUMBER2 IS NULL OR PHONENUMBER2 != PHONENUMBER1, 1, 0)"/>
      <FIELD NAME="EMAIL" EXPRESSION="EMAIL"/>
      <FIELD NAME="DQ_EMAIL_FORMAT" EXPRESSION="IIF(REG_MATCH(EMAIL, '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'), 1, 0)"/>
      <FIELD NAME="WEB" EXPRESSION="WEB"/>
      <FIELD NAME="DQ_WEB_FORMAT" EXPRESSION="IIF(REG_MATCH(WEB, '^(https?://)?([\w.-]+)\.([a-zA-Z]{2,6})([/\w .-]*)*/?$'), 1, 0)"/>
      <FIELD NAME="MEMBER_ID" EXPRESSION="MEMBER_ID"/>
      <FIELD NAME="DQ_MEMBER_ID_RANGE" EXPRESSION="IIF(MEMBER_ID &gt;= 10000000 AND MEMBER_ID &lt;= 99999999, 1, 0)"/>
      <FIELD NAME="DQ_CONTACT_NOTNULL" EXPRESSION="IIF(NOT(ISNULL(PHONENUMBER1)) OR NOT(ISNULL(EMAIL)) OR NOT(ISNULL(WEB)), 1, 0)"/>
    </TRANSFORMATION>

    <TRANSFORMATION NAME="DQ_Aggregator" TYPE="Aggregator" DESCRIPTION="Uniqueness Checks">
      <GROUPBY FIELD="MEMBER_ID"/>
      <FIELD NAME="MEMBER_ID_COUNT" EXPRESSION="COUNT(MEMBER_ID)"/>
    </TRANSFORMATION>

    <TRANSFORMATION NAME="DQ_Router" TYPE="Router" DESCRIPTION="DQ Routing">
      <GROUP NAME="VALID_ROWS" CONDITION="DQ_FIRSTNAME_NOTNULL = 1 AND DQ_LASTNAME_NOTNULL = 1 AND DQ_COMPANY_LEN = 1 AND DQ_ADDRESS_LEN = 1 AND DQ_CITY_VALUE = 1 AND DQ_COUNTRY_NOTNULL = 1 AND DQ_STATE_LEN = 1 AND DQ_ZIP_FORMAT = 1 AND DQ_PHONENUMBER1_NOTNULL = 1 AND DQ_PHONENUMBER2_DISTINCT = 1 AND DQ_EMAIL_FORMAT = 1 AND DQ_WEB_FORMAT = 1 AND DQ_MEMBER_ID_RANGE = 1 AND DQ_CONTACT_NOTNULL = 1 AND MEMBER_ID_COUNT = 1"/>
      <GROUP NAME="REJECTED_ROWS" CONDITION="DQ_FIRSTNAME_NOTNULL = 0 OR DQ_LASTNAME_NOTNULL = 0 OR DQ_COMPANY_LEN = 0 OR DQ_ADDRESS_LEN = 0 OR DQ_CITY_VALUE = 0 OR DQ_COUNTRY_NOTNULL = 0 OR DQ_STATE_LEN = 0 OR DQ_ZIP_FORMAT = 0 OR DQ_PHONENUMBER1_NOTNULL = 0 OR DQ_PHONENUMBER2_DISTINCT = 0 OR DQ_EMAIL_FORMAT = 0 OR DQ_WEB_FORMAT = 0 OR DQ_MEMBER_ID_RANGE = 0 OR DQ_CONTACT_NOTNULL = 0 OR MEMBER_ID_COUNT &gt; 1"/>
    </TRANSFORMATION>

    <TARGET NAME="MEMBERSDATA_VALID" DATABASETYPE="Flat File">
      <FIELD NAME="FIRSTNAME" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="LASTNAME" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="COMPANY" DATATYPE="string" LENGTH="255"/>
      <FIELD NAME="ADDRESS" DATATYPE="string" LENGTH="16777216"/>
      <FIELD NAME="CITY" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="COUNTRY" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="STATE" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="ZIP" DATATYPE="string" LENGTH="20"/>
      <FIELD NAME="PHONENUMBER1" DATATYPE="string" LENGTH="50"/>
      <FIELD NAME="PHONENUMBER2" DATATYPE="string" LENGTH="50"/>
      <FIELD NAME="EMAIL" DATATYPE="string" LENGTH="255"/>
      <FIELD NAME="WEB" DATATYPE="string" LENGTH="255"/>
      <FIELD NAME="MEMBER_ID" DATATYPE="integer" PRECISION="8"/>
    </TARGET>

    <TARGET NAME="DQ_ISSUE_LOG" DATABASETYPE="Flat File">
      <FIELD NAME="TABLE_NAME" DATATYPE="string" LENGTH="50"/>
      <FIELD NAME="COLUMN_NAME" DATATYPE="string" LENGTH="100"/>
      <FIELD NAME="RULE_DESCRIPTION" DATATYPE="string" LENGTH="255"/>
      <FIELD NAME="SEVERITY" DATATYPE="string" LENGTH="20"/>
      <FIELD NAME="LOGGED_AT" DATATYPE="datetime"/>
      <FIELD NAME="BATCH_ID" DATATYPE="integer"/>
      <FIELD NAME="MEMBER_ID" DATATYPE="integer" PRECISION="8"/>
    </TARGET>

    <MAPPING NAME="m_DQ_MEMBERSDATA" DESCRIPTION="DQ validation mapping for MEMBERSDATA">
      <TRANSFORM INSTANCE="SQ_MEMBERSDATA" TYPE="Source Qualifier" SOURCE="MEMBERSDATA"/>
      <TRANSFORM INSTANCE="DQ_Expression" TYPE="Expression"/>
      <TRANSFORM INSTANCE="DQ_Aggregator" TYPE="Aggregator"/>
      <TRANSFORM INSTANCE="DQ_Router" TYPE="Router"/>
      <TRANSFORM INSTANCE="MEMBERSDATA_VALID" TYPE="Target" GROUP="VALID_ROWS"/>
      <TRANSFORM INSTANCE="DQ_ISSUE_LOG" TYPE="Target" GROUP="REJECTED_ROWS"/>
      <CONNECT FROM="SQ_MEMBERSDATA" TO="DQ_Expression"/>
      <CONNECT FROM="DQ_Expression" TO="DQ_Aggregator"/>
      <CONNECT FROM="DQ_Aggregator" TO="DQ_Router"/>
      <CONNECT FROM="DQ_Router" TO="MEMBERSDATA_VALID" GROUP="VALID_ROWS"/>
      <CONNECT FROM="DQ_Router" TO="DQ_ISSUE_LOG" GROUP="REJECTED_ROWS"/>
    </MAPPING>
  </FOLDER>
</POWERMAP>