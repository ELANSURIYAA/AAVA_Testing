=============================================
Author:  Ascendion AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Detailed Cost Breakdown for Running Converted Fabric Code:**

- **Complexity of Original Code:**  
  The Synapse stored procedure `populate_dimensions` is straightforward, containing three main MERGE operations (one per dimension table) with basic data quality filters and deduplication. There are no loops, dynamic SQL, or complex control flow.
- **Expected Data Volume:**  
  - Source: `STG_DIMENSION_DATA` (~150 GB)
  - Targets: `DIM_INSTITUTION` (~700 GB), `DIM_CORPORATION` (not specified, assumed similar), `DIM_PRODUCT` (~100 GB)
  - Total processed data volume (as per environment): ~650 GB (10% of total environment)
- **Job Execution Time Estimate:**  
  - For 650 GB of processed data, with three upsert operations (MERGE/INSERT with NOT EXISTS), estimated runtime is 1.5–2.5 hours on a mid-tier Fabric capacity (assuming parallelism and predicate pushdown).
- **Fabric Environment Pricing:**  
  - Microsoft Fabric Enterprise Capacity: $0.36 – $1.50 per hour (CU-based).
  - For a 2-hour run on a mid-tier (assume $0.80/hour):  
    Runtime Cost = 2 hours × $0.80/hour = **$1.60**
- **Performance Optimizations:**  
  - The conversion will replace MERGE with efficient upsert logic (INSERT with NOT EXISTS), apply early filtering, and avoid temp tables, which should keep costs near the lower end of the range.

**Estimated Runtime Cost:**  
- **$1.60 USD** (for a single run of the converted Fabric code, processing ~650 GB of data on mid-tier capacity)

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Effort Required for Manual Fixes:**

- **MERGE to Upsert Conversion:**  
  Each MERGE needs to be rewritten as an INSERT with NOT EXISTS or anti-join logic (3 tables):  
  - Analysis, rewrite, and validation per table: ~1.5 hours × 3 = **4.5 hours**
- **PRINT/Logging Replacement:**  
  Replace PRINT statements with Fabric logging (minor): **0.5 hour**
- **Procedure Orchestration Refactor:**  
  Move logic from stored procedure to Fabric notebook/script, modularize: **1.0 hour**
- **Testing and Validation of Business Rules:**  
  Ensure all WHERE clause filters and deduplication are preserved: **1.0 hour**

**Total Manual Code Fixes Effort:**  
- **7.0 hours**

#### 2.2 Output Validation Effort

**Effort Required for Output Comparison and Validation:**

- **Data Reconciliation:**  
  Compare outputs between Synapse and Fabric for all three dimension tables, including row counts, sample data, and business rule checks:  
  - Setup, extract, and compare for each table: ~1.0 hour × 3 = **3.0 hours**
- **Edge Case Validation:**  
  Validate idempotency and data quality for edge cases: **1.0 hour**

**Total Output Validation Effort:**  
- **4.0 hours**

#### 2.3 Total Estimated Effort in Hours

**Summary Table:**

| Task                           | Estimated Hours |
|--------------------------------|----------------|
| Manual Code Fixes              | 7.0            |
| Output Validation & Testing    | 4.0            |
| **Total**                      | **11.0**       |

**Justification:**  
- The total effort is the sum of code conversion (rewriting MERGE, logging, orchestration) and validation (reconciliation, edge case testing).
- No complex joins, aggregations, or external dependencies are present, so no additional effort is required.
- The process is straightforward, but care is needed to ensure business rule fidelity and idempotency.

---

### 3. API Cost Consumption

```
apiCost: 0.0160 USD
```

(Based on two file reads at 0.0080 USD each.)

---