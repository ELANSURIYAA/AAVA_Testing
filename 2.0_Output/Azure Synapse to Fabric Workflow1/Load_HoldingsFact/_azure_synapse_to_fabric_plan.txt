=============================================
Author:  AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Estimated Runtime Cost for Converted Fabric Code:**

- **Complexity:** The Synapse procedure (`dbo.LOAD_FACT_EXECUTIVE_SUMMARY`) is low complexity (score: 25/100), with straightforward logic, 4 INNER JOINs, no loops, and simple variable usage.
- **Data Volume:** The main staging table (`STG_HOLDING_METRICS`) and dimension tables are expected to be large, with indicative data volumes from the environment:
  - Largest input table: ~700 GB
  - Target table: ~1 TB
  - Processed data volume (10% of total): ~650 GB (for a typical run)
- **Fabric Pricing:** Microsoft Fabric Enterprise Capacity: $0.36 – $1.50 per hour (CU-based).
- **Estimated Execution Time:** Given the absence of aggregations, no procedural loops, and efficient join structure, a typical load of ~650 GB should complete in **1–2 hours** on a mid-tier Fabric capacity (assuming moderate concurrency and no resource contention).

**Cost Breakdown:**
- **Compute (CU) Cost:**  
  - Lower bound: 1 hour × $0.36 = **$0.36**
  - Upper bound: 2 hours × $1.50 = **$3.00**
- **Estimated Cost per Run:**  
  - **$0.75 – $2.25** (assuming average 1.5 hours on mid-tier capacity)

**Justification:**  
- The cost is driven by the data volume and join operations. No heavy aggregations or procedural logic means the process is I/O and join-bound, not CPU-bound.
- If optimization techniques (CTEs, predicate pushdown, minimal materialization) are applied, runtime may be closer to 1 hour, keeping costs at the lower end.

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes

**Manual Effort Required:**  
- **Variable Declarations:** Refactor/removal of T-SQL variables (`@v_row_count`, `@error_message`) and audit logic: **0.5 hours**
- **Temp Table Conversion:** Replace `#staging_metrics` with CTE or managed table: **1.0 hour**
- **Control Flow:** Convert `IF OBJECT_ID...DROP TABLE`, `PRINT` statements to Fabric-compatible logic/logging: **0.5 hour**
- **Joins:** 4 INNER JOINs, straightforward mapping: **0.5 hour**
- **CASE Expression:** Validate compatibility for `income_amount`: **0.25 hour**
- **Data Type Mapping:** Review and update types (e.g., `DATETIME` to `TIMESTAMP`): **0.25 hour**
- **Total Manual Fixing Effort:** **3.0 hours**

#### 2.2 Output Validation Effort

**Testing Effort Required:**  
- **Data Reconciliation:** Compare row counts and sample data between Synapse and Fabric outputs: **1.0 hour**
- **Business Rule Validation:** Ensure CASE logic and joins yield correct results: **0.5 hour**
- **End-to-End Validation:** Validate referential integrity and data quality: **0.5 hour**
- **Total Validation Effort:** **2.0 hours**

#### 2.3 Total Estimated Effort in Hours

**Total Effort:**  
- **Manual Code Fixes:** 3.0 hours  
- **Validation/Testing:** 2.0 hours  
- **Total:** **5.0 hours**

**Justification:**  
- The effort is low due to the simple structure, minimal procedural logic, and clear join conditions.
- Most work is in temp table/variable refactoring and validation of business rules after conversion.

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```