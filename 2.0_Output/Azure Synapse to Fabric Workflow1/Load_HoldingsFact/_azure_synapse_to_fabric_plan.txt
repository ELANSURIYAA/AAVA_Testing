=============================================
Author:  AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Estimated Runtime Cost for Converted Fabric Code:**

- **Complexity of Synapse Store Procedure code:**  
  The procedure `dbo.LOAD_FACT_EXECUTIVE_SUMMARY` is of low-moderate complexity (score: 25/100), featuring 4 INNER JOINs, conditional logic (CASE), and temp table usage for staging. No loops, subqueries, or advanced error handling are present.
- **Expected Data Volume and Job Execution Time:**  
  Based on the Fabric environment details, the relevant tables (DIM_INSTITUTION, DIM_PRODUCT, DIM_DATE, FACT_EXECUTIVE_SUMMARY) have volumes ranging from ~100 GB to ~1 TB. The processed data volume for similar workloads is ~650 GB.
- **Performance Optimizations in Fabric:**  
  - Temp table logic will be replaced by CTEs or views, reducing intermediate materialization.
  - Joins can be optimized via partitioning and predicate pushdown.
  - No explicit transaction or error handling overhead.

**Fabric Pricing Reference:**  
- Enterprise Capacity Cost: $0.36 – $1.50 per hour (Microsoft Fabric Pricing, CU - Capacity Units)

**Estimated Job Duration:**  
- For a 650 GB processed workload with moderate joins and simple conditional logic, the expected runtime is **1.5–2 hours** on a mid-tier Fabric capacity.

**Cost Calculation:**  
- Using an average cost of $1.00/hour (midpoint for typical enterprise workloads):
  - **Total Estimated Runtime Cost:**  
    2 hours × $1.00/hour = **$2.00 USD**

**Justification:**  
- The workload is primarily a single INSERT with multiple joins and a CASE statement, with no complex procedural logic or looping.
- Data volumes align with the provided environment details, and optimizations (CTEs, predicate pushdown) will keep execution efficient.

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Effort Required for Manual Code Fixes:**

- **Temp Table to CTE/View Conversion:**  
  Refactor temp table logic (`#staging_metrics`) to CTEs/views: **1 hour**
- **Variable Removal/Refactoring:**  
  Remove procedural variables (`@v_row_count`, `@error_message`), replace with query-based row counts or external logging: **0.5 hour**
- **Control Flow & Audit Logging:**  
  Replace PRINT statements and row count tracking with Fabric-compatible logging/monitoring: **0.5 hour**
- **Join Optimization:**  
  Review and optimize INNER JOINs for Fabric: **1 hour**
- **Business Rule Validation:**  
  Ensure CASE logic for `income_amount` is Fabric-compatible and test edge cases: **0.5 hour**

**Total Manual Code Fix Effort:**  
**3.5 hours**

#### 2.2 Output Validation Effort

**Effort Required for Output Validation:**

- **Data Reconciliation:**  
  Compare outputs between Synapse and Fabric for all columns, including business rule logic: **2 hours**
- **Referential Integrity Validation:**  
  Validate join results and dimension key mapping: **1 hour**
- **Row Count and Audit Verification:**  
  Confirm row counts and audit logs are consistent: **0.5 hour**

**Total Output Validation Effort:**  
**3.5 hours**

#### 2.3 Total Estimated Effort in Hours

**Total Effort Calculation:**

- Manual Code Fixes: **3.5 hours**
- Output Validation: **3.5 hours**

**Total Estimated Effort:**  
**7 hours**

**Justification:**  
- Each step is estimated based on the complexity and volume of work required.
- No significant overlap; code fixes and validation are distinct tasks.
- The effort is moderate due to the straightforward nature of the procedure and the absence of advanced procedural constructs.

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```