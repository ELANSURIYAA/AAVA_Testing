=============================================
Author:  AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Estimated Runtime Cost Breakdown:**

- **Complexity of Synapse Store Procedure code:**  
  The procedure loads data from a single staging table, performs validation, applies business rules, and joins with four dimension tables. The logic is straightforward, with no loops or subqueries, but includes temp table usage and conditional expressions.

- **Expected Data Volume and Job Execution Time:**  
  Based on the Fabric environment details, the relevant tables (e.g., DIM_INSTITUTION, DIM_PRODUCT, DIM_DATE, FACT_EXECUTIVE_SUMMARY) each range from ~100 GB to ~1 TB. The processed data volume for a typical run is ~650 GB (10% of total).

- **Performance Optimizations in Fabric:**  
  - Temp tables should be replaced with CTEs or views for better scalability.
  - Joins should leverage partitioning and predicate pushdown.
  - Audit logging and row count tracking must be handled externally.

**Fabric Pricing Reference:**  
- Enterprise Capacity Cost: $0.36 – $1.50 per hour (per Capacity Unit)

**Estimated Execution Time:**  
- For ~650 GB processed data, with four joins and moderate business rules, a typical Fabric job (with optimized SQL) would run in approximately 1.5–2 hours on a mid-tier capacity (assuming 2–4 CUs).

**Estimated Cost Calculation:**  
- Using 2 CUs at $0.90/hr each for 2 hours:  
  2 CUs × $0.90/hr × 2 hrs = $3.60

**Estimated Fabric Runtime Cost:**  
- **$3.60 USD per run** (assuming moderate optimization and no unexpected bottlenecks)

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Effort Breakdown:**

- **Synapse lookups (joins):**  
  4 INNER JOINs need to be validated and possibly rewritten for Fabric syntax and performance.  
  **Effort:** 2 hours

- **Temp table conversion:**  
  Replace `#staging_metrics` with CTEs or views, refactor resource cleanup logic.  
  **Effort:** 2 hours

- **Conditional expressions:**  
  CASE logic for income_amount and IF blocks for resource cleanup need manual review and conversion.  
  **Effort:** 1 hour

- **Audit logging:**  
  Replace PRINT statements and row count tracking with Fabric-compatible logging or external monitoring.  
  **Effort:** 1 hour

- **Variable usage:**  
  Refactor variable usage (`@v_row_count`, `@error_message`) into declarative SQL or external monitoring.  
  **Effort:** 1 hour

**Total Manual Code Fix Effort:**  
**7 hours**

#### 2.2 Output Validation Effort

**Effort Breakdown:**

- **Data reconciliation:**  
  Compare outputs between Synapse and Fabric runs for FACT_EXECUTIVE_SUMMARY.  
  **Effort:** 2 hours

- **Business rule validation:**  
  Ensure CASE logic and joins produce identical results.  
  **Effort:** 1 hour

- **Row count and referential integrity checks:**  
  Validate row counts and join integrity.  
  **Effort:** 1 hour

**Total Output Validation Effort:**  
**4 hours**

#### 2.3 Total Estimated Effort in Hours

**Total Effort Calculation:**  
Manual code fixes: 7 hours  
Output validation: 4 hours  
**Total:** 11 hours

Effort is justified by the need to manually refactor temp tables, conditional logic, audit logging, and validate outputs across large data volumes and multiple joins. Overlap is minimal due to distinct tasks.

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```