=============================================
Author:  AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Estimated Runtime Cost for Converted Fabric Code:**

- **Complexity of Synapse Store Procedure code:**  
  The procedure `dbo.LOAD_FACT_EXECUTIVE_SUMMARY` is moderately complex (Complexity Score: 30/100), involving 4 INNER JOINs, conditional logic (CASE), and temp table usage. No loops or nested subqueries are present.
- **Expected Data Volume and Job Execution Time:**  
  The largest relevant tables for this job are:
    - `dbo.STG_HOLDING_METRICS` (source): Not explicitly sized, but similar staging tables in the environment are ~150 GB.
    - Dimension tables (`DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`): Each ranges from ~100 GB to ~700 GB.
    - Target table (`FACT_EXECUTIVE_SUMMARY`): Expected to be up to ~1 TB after aggregation.
  - **Processed Data Volume:** Estimated at ~650 GB per run (10% of total environment data).
- **Performance Optimizations in Fabric:**  
  - Joins can be optimized using partitioning and indexing.
  - Temp tables replaced with CTEs/views to reduce materialization overhead.
  - Predicate pushdown and modular queries will improve scan efficiency.

**Fabric Pricing Reference:**  
- **Enterprise Capacity Cost:** $0.36 – $1.50 per hour (per CU)
- **Estimated Job Duration:** For 650 GB processed data, with moderate joins and no heavy aggregations, a well-optimized Fabric job should complete in **2–4 hours** on a mid-tier (2–4 CU) capacity.

**Cost Calculation:**
- Assume 2 CUs at $0.75/hr each = $1.50/hr
- Estimated runtime: 3 hours (average)
- **Total Estimated Runtime Cost:**  
  $1.50/hr × 3 hr = **$4.50 USD per run**

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Effort Breakdown:**
- **Synapse lookups/joins:** 4 INNER JOINs need to be validated for Fabric compatibility and performance tuning. (1.5 hours)
- **Temp table conversion:** Replace `#staging_metrics` with CTE/view logic. (1 hour)
- **Conditional expressions:** CASE logic for `income_amount` must be validated. (0.5 hour)
- **Variable declarations:** Refactor `DECLARE @v_row_count`, `@error_message` to Fabric-compatible logging. (0.5 hour)
- **Audit logging:** Replace PRINT statements with Fabric logging/monitoring. (0.5 hour)
- **Cleanup logic:** Remove DROP TABLE statements and ensure ephemeral data handling. (0.5 hour)
- **Data type adjustments:** Ensure compatibility for datetime/timestamp and decimals. (0.5 hour)
- **Manual review of business rule enforcement:** (0.5 hour)

**Total Manual Code Fix Effort:**  
**5 hours**

#### 2.2 Output Validation Effort

**Effort Breakdown:**
- **Data reconciliation:** Compare outputs between Synapse and Fabric for all key metrics in `FACT_EXECUTIVE_SUMMARY`. (2 hours)
- **Referential integrity validation:** Ensure joins to dimension tables are correct. (1 hour)
- **Business rule validation:** Confirm CASE logic and null/negative handling. (1 hour)
- **Audit log review:** Validate row counts and error handling. (1 hour)

**Total Output Validation Effort:**  
**5 hours**

#### 2.3 Total Estimated Effort in Hours

**Total Effort Calculation:**  
Manual Code Fixes: 5 hours  
Output Validation: 5 hours  
**Total Estimated Effort:** **10 hours**

*Justification:*  
Tasks are largely sequential with minimal overlap. Each area requires focused manual review due to the shift from procedural to declarative logic and the need for robust validation to ensure reporting accuracy.

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```