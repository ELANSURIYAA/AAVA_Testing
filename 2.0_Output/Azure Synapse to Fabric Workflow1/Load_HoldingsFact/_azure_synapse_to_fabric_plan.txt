=============================================
Author:  AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Estimated Data Volume:**  
- Source table (`STG_HOLDING_METRICS`): ~700 GB  
- Dimension tables (DIM_INSTITUTION, DIM_PRODUCT, DIM_CORPORATION, DIM_DATE): Each ~100–700 GB  
- Target table (`FACT_EXECUTIVE_SUMMARY`): ~1 TB  
- Processed data volume for this job: ~650 GB (based on indicative 10% of total)

**Fabric Pricing:**  
- Enterprise Capacity Cost: $0.36 – $1.50 per hour (per Capacity Unit, CU)

**Estimated Job Runtime:**  
- For a moderately complex ETL with multiple joins and data cleansing (complexity score: 30/100), processing ~650 GB is expected to take **1.5 to 2.5 hours** on a mid-tier Fabric capacity (e.g., 2–4 CUs).

**Cost Breakdown:**  
- Using 2 CUs at $0.75/hr each for 2 hours: 2 x $0.75 x 2 = **$3.00**
- Using 4 CUs at $0.50/hr each for 2 hours: 4 x $0.50 x 2 = **$4.00**

**Justification:**  
- The job involves one main insert with four joins, a temp table (to be replaced by CTEs), and conditional logic.
- No heavy aggregations or procedural loops, so parallelization is efficient.
- Data volumes are significant, but not extreme for Fabric.
- No external calls or complex orchestration.

**Estimated Fabric Runtime Cost:**  
**$3.00 – $4.00 per run** (assuming mid-tier capacity and average data volume).

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Manual Fixes Required:**  
- Replace all variable declarations and usages (`@v_row_count`, `@error_message`) with query-based constructs or logging.
- Replace temp table (`#staging_metrics`) with CTEs or views.
- Refactor IF statements for temp table existence and cleanup.
- Replace PRINT statements with Fabric-supported logging or monitoring.
- Review and adapt CASE expressions for Fabric SQL compatibility.
- Validate all joins for schema and data type compatibility.

**Estimated Effort:**  
- Variable and control flow refactoring: **1.5 hours**
- Temp table to CTE/view refactor: **2 hours**
- Logging/audit logic adaptation: **1 hour**
- Join and CASE logic review: **1 hour**
- Miscellaneous adjustments (data types, error handling): **0.5 hour**

**Total Manual Code Fixes:** **6 hours**

#### 2.2 Output Validation Effort

**Validation Steps:**  
- Run the original Synapse procedure and capture output row counts and sample data.
- Run the converted Fabric code and capture equivalent outputs.
- Compare results for parity (row counts, key metrics, sample data).
- Investigate and resolve any discrepancies.

**Estimated Effort:**  
- Test data preparation and baseline capture: **1 hour**
- Fabric run and output extraction: **1 hour**
- Data reconciliation and investigation: **2 hours**

**Total Output Validation Effort:** **4 hours**

#### 2.3 Total Estimated Effort in Hours

**Summary Table:**

| Task                         | Effort (hours) |
|------------------------------|---------------|
| Manual Code Fixes            | 6             |
| Output Validation/Testing    | 4             |
| **Total**                    | **10**        |

**Justification:**  
- The code is moderately complex, with most effort in temp table refactoring and validation.
- No loops, subqueries, or procedural calls reduce complexity.
- Validation effort is moderate due to straightforward business logic and clear input/output mapping.

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```