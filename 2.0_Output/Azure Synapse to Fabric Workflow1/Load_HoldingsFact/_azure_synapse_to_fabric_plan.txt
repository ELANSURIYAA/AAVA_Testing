=============================================
Author:  AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Estimated Runtime Cost for Converted Fabric Code:**

The Synapse procedure `dbo.LOAD_FACT_EXECUTIVE_SUMMARY` processes data from a staging table, performs joins with four dimension tables, applies business rule validation (CASE), and loads into a fact table. Based on the Fabric environment details:

- **Indicative Data Volume:**  
  - Largest table processed: up to ~1 TB (target), with typical processed data volume ~650 GB per run.
- **Fabric Capacity Pricing:**  
  - $0.36 – $1.50 per hour (CU-based).
- **Expected Execution Time:**  
  - For a set-based operation with joins and conditional logic, estimated runtime is **1.5–2 hours** per full load (assuming moderate optimization and no excessive resource contention).
- **Performance Optimizations:**  
  - Use of CTEs instead of temp tables.
  - Early predicate filtering.
  - Modular joins.

**Cost Calculation:**  
- **Lower Bound:** 1.5 hours × $0.36 = $0.54  
- **Upper Bound:** 2 hours × $1.50 = $3.00  
- **Typical Estimate:** 2 hours × $0.90 (mid-tier CU) = **$1.80 per run**

**Justification:**  
- The procedure’s complexity is moderate (Complexity Score: 25), with no loops or heavy aggregations.
- Data volume is significant, but the set-based logic and optimized joins in Fabric should keep runtime reasonable.
- If incremental loads or partitioning are used, costs may be lower.

**Estimated Fabric Runtime Cost per run:**  
**$1.80 USD**

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Manual Effort Required:**

- **Temp Table Replacement:**  
  - Refactor temp table logic (`#staging_metrics`) to CTEs or inline subqueries.
  - Estimated effort: **1.5 hours**
- **Variable and Print Statements:**  
  - Remove/replace variable declarations, assignments, and PRINT statements with Fabric-compatible logging.
  - Estimated effort: **1 hour**
- **Joins and Lookups:**  
  - Validate and refactor joins to ensure referential integrity.
  - Estimated effort: **1 hour**
- **Conditional Expressions:**  
  - Validate and migrate CASE logic for `income_amount`.
  - Estimated effort: **0.5 hours**
- **Audit Logging:**  
  - Implement row count/audit logic using Fabric monitoring.
  - Estimated effort: **1 hour**

**Total Manual Code Fix Effort:**  
**5 hours**

#### 2.2 Output Validation Effort

**Effort to Compare and Validate Outputs:**

- **Data Reconciliation:**  
  - Compare row counts and key metrics between Synapse and Fabric outputs.
  - Estimated effort: **2 hours**
- **Business Rule Validation:**  
  - Ensure CASE logic and referential integrity produce identical results.
  - Estimated effort: **1 hour**
- **Edge Case Testing:**  
  - Validate handling of NULLs, negative values, and join failures.
  - Estimated effort: **1 hour**

**Total Output Validation Effort:**  
**4 hours**

#### 2.3 Total Estimated Effort in Hours

**Total Effort Calculation:**  
Manual Code Fixes: 5 hours  
+ Output Validation: 4 hours  
= **9 hours**

**Justification:**  
- The tasks are largely sequential, with some overlap in validation and code refactoring.
- Complexity is moderate, with most effort spent on temp table replacement and audit logic.
- No external dependencies or procedural calls reduce integration overhead.

**Total Estimated Effort:**  
**9 hours**

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```