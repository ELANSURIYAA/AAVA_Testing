=============================================
Author:  AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

**Estimated Runtime Cost for Converted Fabric Code:**

- **Complexity of Source Procedure:**  
  The Synapse procedure (`LOAD_FACT_EXECUTIVE_SUMMARY`) is of low-moderate complexity (complexity score: 25/100). It involves:
  - 4 INNER JOINs for referential integrity.
  - Conditional logic (CASE, IF).
  - Use of a temp table for staging.
  - No loops or subqueries.
  - No aggregations.
- **Expected Data Volume:**  
  - Input table (`STG_HOLDING_METRICS`): Estimated at ~700 GB (based on similar table sizes in the environment).
  - Output table (`FACT_EXECUTIVE_SUMMARY`): Up to ~1 TB.
  - Processed data volume (10% of total): ~650 GB per run.
- **Fabric Environment Details:**  
  - Enterprise Capacity Cost: $0.36 – $1.50 per hour (CU-based).
  - Large data volumes and multiple joins will require moderate compute.
- **Estimated Job Execution Time:**  
  - For 650 GB processed with moderate complexity and no aggregations: ~1.5 to 2 hours per run on a mid-tier Fabric capacity.
- **Performance Optimizations in Fabric:**  
  - Temp table logic will be replaced with CTEs, reducing materialization overhead.
  - Early predicate pushdown and join filtering will improve performance.
  - No dynamic SQL or procedural loops to slow execution.

**Cost Breakdown:**
- Compute (1.5–2 hours @ $0.90/hr average): $1.35 – $1.80 per run.
- Storage: Included in Fabric compute cost for this scenario.
- Logging/Audit: Negligible incremental cost.

**Estimated Fabric Runtime Cost per Execution:**  
**$1.50 USD** (rounded, assuming mid-tier capacity and moderate optimization)

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

| Area                        | Manual Fix Description                                                | Estimated Effort (hours) |
|-----------------------------|----------------------------------------------------------------------|-------------------------|
| Temp Table Refactor         | Convert temp table logic to CTEs or views                            | 2                       |
| Variable Usage              | Refactor procedural variables to query-based logic                   | 1                       |
| Conditional Logic           | Convert IF/CASE logic to declarative SQL                             | 1                       |
| Audit Logging               | Replace PRINT statements with Fabric-compatible logging/audit tables | 1                       |
| Object Existence Checks     | Remove/replace OBJECT_ID checks                                      | 0.5                     |
| Data Type/Conversion Review | Review and update data types for compatibility                       | 0.5                     |
| **Subtotal**                |                                                                      | **6 hours**             |

#### 2.2 Output Validation Effort

| Validation Task                        | Description                                                        | Estimated Effort (hours) |
|----------------------------------------|--------------------------------------------------------------------|-------------------------|
| Data Reconciliation                    | Compare outputs between Synapse and Fabric                         | 2                       |
| Business Rule Validation               | Validate CASE logic and referential joins                          | 1                       |
| Row Count & Integrity Checks           | Confirm record counts and join integrity                           | 1                       |
| **Subtotal**                           |                                                                    | **4 hours**             |

#### 2.3 Total Estimated Effort in Hours

- **Manual Code Fixes:** 6 hours
- **Output Validation:** 4 hours
- **Total Estimated Effort:** **10 hours**

**Justification:**  
- Manual code fixes are straightforward due to low-moderate complexity and absence of deeply nested or procedural logic.
- Output validation is simplified by the lack of aggregations and the direct mapping of source to target.
- Some overlap (e.g., reviewing joins while validating output) is accounted for in the total.

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```