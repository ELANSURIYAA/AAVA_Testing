=============================================
Author:        Ascendion AVA+
Date:   
Description:   This document details the SAS script for extracting, transforming, and exporting healthcare plan data for marketing campaign targeting.
=============================================

## Overview of Program

The `marketing_healthcare_extract.sas` code is designed to automate the extraction, transformation, and export of healthcare plan data for marketing campaign targeting. The program connects securely to a Teradata database, applies business rules to identify eligible members, enriches the data with provider network details, and outputs a campaign-ready file. The business problem addressed is the need for precise, rule-based segmentation of healthcare members to optimize marketing outreach and improve campaign effectiveness. By automating these steps, the code ensures data consistency, compliance, and timely delivery for marketing operations.

## Code Structure and Design

The code is modular, with each step handling a distinct part of the ETL (Extract, Transform, Load) process:
- **Step 1:** Establishes a secure connection to the Teradata source system using a metadata-authenticated library reference.
- **Step 2:** Uses PROC SQL to join and transform data from healthcare plans and provider network tables, applying business logic for segmentation and eligibility.
- **Step 3:** Filters the enriched dataset to retain only campaign-eligible members.
- **Step 4:** Exports the final list to a CSV file for downstream marketing use.

Primary components include:
- Tables: `tdata.healthcare_plans`, `tdata.provider_network`, `work.marketing_extract`, `work.final_campaign_list`
- Joins: LEFT JOIN between plans and provider network
- Aggregations: Age grouping, marketing segment creation, eligibility logic
- Transformations: Field concatenation, case logic, upcase, and filtering

## Data Flow and Processing Logic

**Processed Datasets:**
- tdata.healthcare_plans
- tdata.provider_network
- work.marketing_extract
- work.final_campaign_list

**Data Flow:**
The process begins by extracting raw member and plan data from Teradata. This data is joined with provider network information to enrich each record. Business rules are applied to classify members by age group, create marketing segments, and determine campaign eligibility. The dataset is then filtered to include only eligible members, and the final output is exported as a CSV file for marketing use.

### Logical Processing Components

1. **Teradata Connection**
   - Functionality: Securely connects to Teradata using a libname statement.
   - Transformation: None (connection only).

2. **Data Extraction and Enrichment (PROC SQL)**
   - Functionality: Joins healthcare plans with provider network, applies business rules.
   - Transformations:
     - Concatenates first and last names.
     - Classifies age groups.
     - Creates marketing segments.
     - Applies eligibility logic using CASE statements.
     - Filters for active plans and non-null ages.

3. **Eligibility Filtering (DATA Step)**
   - Functionality: Filters dataset to retain only eligible members.
   - Transformation: Conditional logic on `is_campaign_eligible`.

4. **Export (PROC EXPORT)**
   - Functionality: Writes the final dataset to a CSV file.
   - Transformation: None (output only).

## Data Mapping

| Target Table Name         | Target Column Name   | Source Table Name      | Source Column Name      | Remarks                                      |
|--------------------------|---------------------|------------------------|------------------------|----------------------------------------------|
| work.marketing_extract   | member_id           | tdata.healthcare_plans | member_id              | 1 to 1 mapping                              |
| work.marketing_extract   | member_full_name    | tdata.healthcare_plans | member_first_name, member_last_name | Transformation (concatenation)              |
| work.marketing_extract   | member_age          | tdata.healthcare_plans | member_age             | 1 to 1 mapping                              |
| work.marketing_extract   | age_group           | tdata.healthcare_plans | member_age             | Transformation (CASE logic for grouping)     |
| work.marketing_extract   | plan_id             | tdata.healthcare_plans | plan_id                | 1 to 1 mapping                              |
| work.marketing_extract   | plan_type           | tdata.healthcare_plans | plan_type              | 1 to 1 mapping                              |
| work.marketing_extract   | region              | tdata.healthcare_plans | region                 | 1 to 1 mapping                              |
| work.marketing_extract   | network_type        | tdata.provider_network | network_type           | 1 to 1 mapping (via LEFT JOIN)              |
| work.marketing_extract   | marketing_segment   | tdata.healthcare_plans | plan_type, region      | Transformation (UPCASE, concatenation)       |
| work.marketing_extract   | is_campaign_eligible| tdata.healthcare_plans, tdata.provider_network | plan_status, member_age, plan_type, region, network_type | Transformation (complex CASE logic)          |
| work.final_campaign_list | *                   | work.marketing_extract | *                      | Validation (is_campaign_eligible = 1 filter) |

## Complexity Analysis

| Metric                   | Value                                |
|--------------------------|--------------------------------------|
| Number of Lines          | 54                                   |
| Datasets Used            | 4                                    |
| Joins Used               | LEFT JOIN                            |
| TRANSFORM Functions      | 5 (CASE, concatenation, UPCASE, filter, validation) |
| RECORD Definitions       | 2 (work.marketing_extract, work.final_campaign_list) |
| OUTPUT Statements        | 1 (PROC EXPORT)                      |
| Conditional Logic        | 2 (CASE for age_group, eligibility)  |
| Indexing and Lookups     | None                                 |
| Function Calls           | 3 (TRIM, UPCASE, PROC EXPORT)        |
| Performance Controls     | None                                 |
| External Dependencies    | Teradata (tdata libname)             |
| Overall Complexity Score | 35                                   |

## Key Outputs

- **work.final_campaign_list**: SAS dataset containing only members eligible for the marketing campaign, based on business rules.
- **final_marketing_campaign_extract_2025.csv**: CSV file exported for use by the marketing team, containing all required fields for campaign execution.

These outputs ensure that only qualified, segmented members are targeted, aligning with business goals for efficient and compliant marketing outreach.

## API Cost

API cost: 0.01 $