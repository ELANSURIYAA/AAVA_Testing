=============================================
Author:        Ascendion AVA+
Date:   
Description:   This document details the purpose, structure, data flow, mappings, and outputs of the marketing_healthcare_extract.sas code, which extracts, transforms, and exports healthcare plan data for targeted marketing campaigns.
=============================================

## Overview of Program

The `marketing_healthcare_extract.sas` program is designed to automate the extraction and transformation of healthcare plan data for marketing purposes. It connects securely to a Teradata database, applies business rules to determine member eligibility for marketing campaigns, enriches the data with provider network information, and exports the final list for downstream use. The business problem addressed is the efficient identification and extraction of eligible healthcare plan members for targeted marketing, ensuring compliance with campaign criteria and maximizing outreach effectiveness. This automation reduces manual effort, improves data accuracy, and supports timely marketing initiatives in the healthcare sector.

## Code Structure and Design

The code is structured into four main steps: (1) establishing a secure Teradata connection, (2) extracting and transforming data using PROC SQL, (3) filtering eligible members with a DATA step, and (4) exporting the results to a CSV file. The primary components include the use of LIBNAME for database connectivity, SQL joins and aggregations for data enrichment, conditional logic for eligibility, and PROC EXPORT for output generation. The flow is modular, with each step handling a distinct part of the ETL process, ensuring maintainability and clarity. Key SAS constructs used are tables, views, joins, aggregations, and transformation logic embedded in SQL and DATA steps.

## Data Flow and Processing Logic

**Processed Datasets:**  
- tdata.healthcare_plans  
- tdata.provider_network  
- work.marketing_extract  
- work.final_campaign_list  

**Data Flow:**  
The program begins by connecting to the Teradata source, reading raw healthcare plan and provider network data. It then creates an enriched working table (`work.marketing_extract`) by joining and transforming the source data, applying business rules for segmentation and eligibility. Next, it filters this dataset to retain only campaign-eligible members, storing the result in `work.final_campaign_list`. Finally, the eligible records are exported as a CSV file for use in marketing campaigns.

### Processing Logic Components

1. **Teradata Connection:**  
   - Securely connects to Teradata using metadata-authenticated LIBNAME.
   - Ensures data access is controlled and auditable.

2. **Data Extraction and Enrichment (PROC SQL):**  
   - Joins `healthcare_plans` and `provider_network` on `plan_id`.
   - Creates calculated fields: `member_full_name`, `age_group`, `marketing_segment`.
   - Applies eligibility logic using CASE statements (e.g., age, plan type, region, network type).
   - Filters for active plans and non-null ages.

3. **Eligibility Filtering (DATA Step):**  
   - Selects only records where `is_campaign_eligible = 1`.

4. **Export (PROC EXPORT):**  
   - Writes the final eligible member list to a CSV file for downstream marketing use.

## Data Mapping

| Target Table Name         | Target Column Name    | Source Table Name      | Source Column Name      | Remarks                                             |
|--------------------------|----------------------|-----------------------|------------------------|-----------------------------------------------------|
| work.marketing_extract   | member_id            | tdata.healthcare_plans| member_id              | 1 to 1 mapping                                      |
| work.marketing_extract   | member_full_name     | tdata.healthcare_plans| member_first_name, member_last_name | Transformation: Concatenation and TRIM              |
| work.marketing_extract   | member_age           | tdata.healthcare_plans| member_age             | 1 to 1 mapping                                      |
| work.marketing_extract   | age_group            | tdata.healthcare_plans| member_age             | Transformation: CASE statement for age segmentation  |
| work.marketing_extract   | plan_id              | tdata.healthcare_plans| plan_id                | 1 to 1 mapping                                      |
| work.marketing_extract   | plan_type            | tdata.healthcare_plans| plan_type              | 1 to 1 mapping                                      |
| work.marketing_extract   | region               | tdata.healthcare_plans| region                 | 1 to 1 mapping                                      |
| work.marketing_extract   | network_type         | tdata.provider_network| network_type           | 1 to 1 mapping (via LEFT JOIN on plan_id)           |
| work.marketing_extract   | marketing_segment    | tdata.healthcare_plans| plan_type, region      | Transformation: UPPER and concatenation              |
| work.marketing_extract   | is_campaign_eligible | tdata.healthcare_plans, tdata.provider_network | plan_status, member_age, plan_type, region, network_type | Transformation: Complex CASE logic                  |
| work.final_campaign_list | (all columns above)  | work.marketing_extract| (all columns)          | Validation: Filter where is_campaign_eligible = 1    |

## Complexity Analysis

| Metric                   | Value                                |
|--------------------------|--------------------------------------|
| Number of Lines          | 54                                   |
| Datasets Used            | 4                                    |
| Joins Used               | LEFT JOIN                            |
| TRANSFORM Functions      | 5 (TRIM, CONCAT, CASE, UPPER, logical expressions) |
| RECORD Definitions       | 2 (work.marketing_extract, work.final_campaign_list) |
| OUTPUT Statements        | 1 (PROC EXPORT)                      |
| Conditional Logic        | 2 (CASE in SQL, IF in DATA step)     |
| Indexing and Lookups     | 1 (JOIN on plan_id)                  |
| Function Calls           | 5 (TRIM, UPPER, CONCAT, CASE, PROC EXPORT) |
| Performance Controls     | None explicit (relies on SQL pushdown)|
| External Dependencies    | Teradata LIBNAME, CSV export path    |
| Overall Complexity Score | 38                                   |

## Key Outputs

- **work.final_campaign_list:** The final SAS dataset containing only members eligible for the marketing campaign, based on business rules.
- **final_marketing_campaign_extract_2025.csv:** CSV file exported for use by the marketing team, containing all required fields for campaign execution.

These outputs ensure that only qualified members are targeted, aligning with business goals of precision marketing and regulatory compliance.

## API Cost

API cost with the proper calculation: 0.02 $