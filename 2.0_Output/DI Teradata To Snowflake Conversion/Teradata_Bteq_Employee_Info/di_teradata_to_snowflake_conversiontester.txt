```
=============================================
Author:        Ascendion AVA+
Created on:   
Description:   Test cases and Pytest script for validating Snowflake SQL code converted from Teradata, focusing on syntax, logic, and manual interventions.
=============================================

**Test Case Document**

|Test Case ID|Description|Expected Result|
|------------|-----------|---------------|
|TC001|Validate syntax changes: Ensure Snowflake SQL executes without syntax errors (no BTEQ scripting, no primary index)|Snowflake SQL runs successfully, table created, data inserted|
|TC002|Logical equivalence: Validate that employee_bkup contains correct join results from Employee and Salary|Results in employee_bkup match expected join output|
|TC003|Manual intervention: Ensure no unsupported Teradata BTEQ commands remain (.LOGON, .LOGOFF, .IF, etc.)|No BTEQ scripting present in Snowflake SQL|
|TC004|Edge case: Employee with no matching Salary|Such Employee is not present in employee_bkup|
|TC005|Edge case: Salary with no matching Employee|Such Salary is not present in employee_bkup|
|TC006|Edge case: NULL EmployeeNo in either table|Rows with NULL EmployeeNo are excluded from employee_bkup|
|TC007|Negative: Insert over-length FirstName/LastName (over 30 chars)|Snowflake truncates or errors as per VARCHAR(30) definition|
|TC008|Negative: Insert string into NetPay (should be INTEGER)|Snowflake errors on type mismatch|
|TC009|Snowflake-specific: Validate RBAC - only authorized role can create/insert into employee_bkup|Unauthorized role gets permission error|
|TC010|Snowflake-specific: Query optimization - check query profile for join efficiency|Query profiler shows join executed efficiently|
|TC011|Snowflake-specific: Handle empty Employee and Salary tables|employee_bkup remains empty|
|TC012|Performance: Compare execution time for join and insert|Execution time is within expected Snowflake performance range|

**Pytest Script**

```python
import pytest
from snowflake.connector import connect, ProgrammingError

@pytest.fixture(scope="module")
def snowflake_connection():
    conn = connect(
        user='YOUR_USER',
        password='YOUR_PASSWORD',
        account='YOUR_ACCOUNT',
        warehouse='YOUR_WAREHOUSE',
        database='YOUR_DATABASE',
        schema='PUBLIC'
    )
    yield conn
    conn.close()

@pytest.fixture(autouse=True)
def setup_and_teardown(snowflake_connection):
    cursor = snowflake_connection.cursor()
    cursor.execute("DROP TABLE IF EXISTS employee_bkup;")
    cursor.execute("DROP TABLE IF EXISTS Employee;")
    cursor.execute("DROP TABLE IF EXISTS Salary;")
    yield
    cursor.execute("DROP TABLE IF EXISTS employee_bkup;")
    cursor.execute("DROP TABLE IF EXISTS Employee;")
    cursor.execute("DROP TABLE IF EXISTS Salary;")

def create_tables(cursor):
    cursor.execute("""
        CREATE OR REPLACE TABLE Employee (
            EmployeeNo INTEGER,
            FirstName VARCHAR(30),
            LastName VARCHAR(30),
            DepartmentNo SMALLINT
        );
    """)
    cursor.execute("""
        CREATE OR REPLACE TABLE Salary (
            EmployeeNo INTEGER,
            NetPay INTEGER
        );
    """)

def run_main_sql(cursor):
    cursor.execute("DROP TABLE IF EXISTS employee_bkup;")
    cursor.execute("""
        CREATE OR REPLACE TABLE employee_bkup (
            EmployeeNo INTEGER,
            FirstName VARCHAR(30),
            LastName VARCHAR(30),
            DepartmentNo SMALLINT,
            NetPay INTEGER
        );
    """)
    cursor.execute("""
        INSERT INTO employee_bkup (
            EmployeeNo, FirstName, LastName, DepartmentNo, NetPay
        )
        SELECT a.EmployeeNo, a.FirstName, a.LastName, a.DepartmentNo, b.NetPay
        FROM Employee a
        INNER JOIN Salary b
        ON a.EmployeeNo = b.EmployeeNo;
    """)

def fetch_all(cursor, sql):
    cursor.execute(sql)
    return cursor.fetchall()

def test_TC001_syntax_changes(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    try:
        run_main_sql(cursor)
    except ProgrammingError:
        pytest.fail("Syntax error in Snowflake SQL")

def test_TC002_logical_equivalence(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    cursor.execute("INSERT INTO Employee VALUES (1, 'Alice', 'Wong', 10), (2, 'Bob', 'Lee', 20);")
    cursor.execute("INSERT INTO Salary VALUES (1, 7000), (2, 8000);")
    run_main_sql(cursor)
    result = fetch_all(cursor, "SELECT * FROM employee_bkup ORDER BY EmployeeNo;")
    assert result == [(1, 'Alice', 'Wong', 10, 7000), (2, 'Bob', 'Lee', 20, 8000)]

def test_TC003_no_bteq_commands(snowflake_connection):
    # This test is conceptual: ensure no .LOGON, .IF, etc. in SQL
    # In practice, this is a code review/static check, not runtime
    sql_script = """
    DROP TABLE IF EXISTS employee_bkup;
    CREATE OR REPLACE TABLE employee_bkup (
        EmployeeNo INTEGER,
        FirstName VARCHAR(30),
        LastName VARCHAR(30),
        DepartmentNo SMALLINT,
        NetPay INTEGER
    );
    """
    assert all(cmd not in sql_script for cmd in [".LOGON", ".LOGOFF", ".IF", ".GOTO", ".LABEL", ".EXIT"])

def test_TC004_employee_no_salary(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    cursor.execute("INSERT INTO Employee VALUES (1, 'Alice', 'Wong', 10), (2, 'Bob', 'Lee', 20);")
    cursor.execute("INSERT INTO Salary VALUES (1, 7000);")
    run_main_sql(cursor)
    result = fetch_all(cursor, "SELECT * FROM employee_bkup;")
    assert result == [(1, 'Alice', 'Wong', 10, 7000)]

def test_TC005_salary_no_employee(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    cursor.execute("INSERT INTO Employee VALUES (1, 'Alice', 'Wong', 10);")
    cursor.execute("INSERT INTO Salary VALUES (1, 7000), (2, 8000);")
    run_main_sql(cursor)
    result = fetch_all(cursor, "SELECT * FROM employee_bkup;")
    assert result == [(1, 'Alice', 'Wong', 10, 7000)]

def test_TC006_null_employee_no(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    cursor.execute("INSERT INTO Employee VALUES (NULL, 'Null', 'Emp', 30), (2, 'Jane', 'Smith', 20);")
    cursor.execute("INSERT INTO Salary VALUES (2, 6000), (NULL, 7000);")
    run_main_sql(cursor)
    result = fetch_all(cursor, "SELECT * FROM employee_bkup;")
    assert result == [(2, 'Jane', 'Smith', 20, 6000)]

def test_TC007_overlength_fields(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    over_length = 'A' * 40
    cursor.execute("INSERT INTO Employee VALUES (1, %s, %s, 10);", (over_length, over_length))
    cursor.execute("INSERT INTO Salary VALUES (1, 5000);")
    run_main_sql(cursor)
    result = fetch_all(cursor, "SELECT FirstName, LastName FROM employee_bkup WHERE EmployeeNo=1;")
    assert result[0][0] == over_length[:30]
    assert result[0][1] == over_length[:30]

def test_TC008_wrong_type_in_netpay(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    cursor.execute("INSERT INTO Employee VALUES (1, 'Test', 'User', 10);")
    with pytest.raises(ProgrammingError):
        cursor.execute("INSERT INTO Salary VALUES (1, 'notanumber');")

def test_TC009_rbac_permission(snowflake_connection):
    # This test assumes a role/user with insufficient permissions is available
    # For demonstration, we expect a permission error (would need setup in real env)
    try:
        conn2 = connect(
            user='UNAUTHORIZED_USER',
            password='PASSWORD',
            account='YOUR_ACCOUNT',
            warehouse='YOUR_WAREHOUSE',
            database='YOUR_DATABASE',
            schema='PUBLIC'
        )
        cursor2 = conn2.cursor()
        with pytest.raises(ProgrammingError):
            cursor2.execute("CREATE TABLE employee_bkup (EmployeeNo INTEGER);")
    except Exception:
        pass  # Skip if environment does not support

def test_TC011_empty_tables(snowflake_connection):
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    run_main_sql(cursor)
    result = fetch_all(cursor, "SELECT * FROM employee_bkup;")
    assert result == []

def test_TC012_performance(snowflake_connection):
    import time
    cursor = snowflake_connection.cursor()
    create_tables(cursor)
    # Insert 1000 rows
    for i in range(1000):
        cursor.execute("INSERT INTO Employee VALUES (%s, 'A', 'B', 1);", (i,))
        cursor.execute("INSERT INTO Salary VALUES (%s, 1000);", (i,))
    start = time.time()
    run_main_sql(cursor)
    elapsed = time.time() - start
    assert elapsed < 10  # Example: should run in under 10 seconds for 1000 rows

# Note: Query profiler and advanced RBAC checks require Snowflake account setup and may need manual review.
```

**Cost Analysis**
API Cost: $0.0028
```