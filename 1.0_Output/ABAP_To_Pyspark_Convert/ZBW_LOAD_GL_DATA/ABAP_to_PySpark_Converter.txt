# Converted PySpark Code

from pyspark.sql import SparkSession
from pyspark.sql.functions import when, col

# Initialize the Spark session
spark = SparkSession.builder \
    .appName("ZBW_LOAD_GL_DATA Conversion") \
    .getOrCreate()

# Read data from the 'gl_table' database table
# Note: Adjust the read options based on your specific data source and connection details.
df_gl = spark.read.format("jdbc").options(
    url="jdbc:your_database_url",
    dbtable="gl_table",
    user="your_username",
    password="your_password"
).load()

# Show initial schema and sample data (for debugging purposes)
df_gl.printSchema()
df_gl.show()

# Process the DataFrame: For records where 'blart' == 'KR', negate the 'dmbtr' field
df_gl_transformed = df_gl.withColumn(
    "dmbtr",
    when(col("blart") == "KR", col("dmbtr") * -1).otherwise(col("dmbtr"))
)

# Optional: Persist the transformed data if needed
# df_gl_transformed.write.format("jdbc").options(
#     url="jdbc:your_database_url",
#     dbtable="gl_table_transformed",
#     user="your_username",
#     password="your_password"
# ).save()

# Log completion message
print("Data load complete")

# Stop the Spark session if no further processing is required
spark.stop()

# Cost consumed by the API for this call: $0.002