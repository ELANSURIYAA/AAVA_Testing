// MongoDB equivalent code for MarkLogic functions

const { MongoClient } = require('mongodb');

// MongoDB connection URI and database name
const uri = "mongodb://localhost:27017";
const dbName = "exampleDB";

async function loadDocuments() {
    const client = new MongoClient(uri);
    try {
        await client.connect();
        const db = client.db(dbName);
        const collection = db.collection("documents");

        // Simulate loading documents
        const doc1 = { _id: "doc1", content: "Content of doc1" };
        const doc2 = { _id: "doc2", content: "Content of doc2" };

        await collection.insertMany([doc1, doc2]);
        console.log("Documents loaded:", [doc1, doc2]);
    } finally {
        await client.close();
    }
}

async function insertDocument(uri, content) {
    const client = new MongoClient(uri);
    try {
        await client.connect();
        const db = client.db(dbName);
        const collection = db.collection("documents");

        const doc = { _id: uri, content: content };
        await collection.insertOne(doc);
        console.log("Document inserted:", doc);
    } finally {
        await client.close();
    }
}

async function searchDocuments(keyword) {
    const client = new MongoClient(uri);
    try {
        await client.connect();
        const db = client.db(dbName);
        const collection = db.collection("documents");

        const results = await collection.find({ content: { $regex: keyword, $options: "i" } }).toArray();
        console.log("Search results:", results);
        return results;
    } finally {
        await client.close();
    }
}

async function updateDocument(uri, newContent) {
    const client = new MongoClient(uri);
    try {
        await client.connect();
        const db = client.db(dbName);
        const collection = db.collection("documents");

        const updatedDoc = await collection.updateOne(
            { _id: uri },
            { $set: { content: newContent } }
        );
        console.log("Document updated:", updatedDoc);
    } finally {
        await client.close();
    }
}

async function deleteDocument(uri) {
    const client = new MongoClient(uri);
    try {
        await client.connect();
        const db = client.db(dbName);
        const collection = db.collection("documents");

        const result = await collection.deleteOne({ _id: uri });
        console.log("Document deleted:", result);
    } finally {
        await client.close();
    }
}

async function queryExample() {
    const client = new MongoClient(uri);
    try {
        await client.connect();
        const db = client.db(dbName);
        const collection = db.collection("documents");

        const sampleDoc = { _id: "sample", title: "MarkLogic Querying", body: "Learning XQuery in MarkLogic." };
        await collection.insertOne(sampleDoc);

        const insertedDoc = await collection.findOne({ _id: "sample" });
        const searchResults = await collection.find({ content: { $regex: "Learning", $options: "i" } }).toArray();

        console.log("Inserted Document URI:", sampleDoc._id);
        console.log("Search Results:", searchResults);
    } finally {
        await client.close();
    }
}

async function main() {
    await loadDocuments();
    await insertDocument("newdoc", "This is a new document");
    await updateDocument("doc1", "Updated content here");
    await searchDocuments("example");
    await deleteDocument("doc2");
    await queryExample();
}

main().catch(console.error);