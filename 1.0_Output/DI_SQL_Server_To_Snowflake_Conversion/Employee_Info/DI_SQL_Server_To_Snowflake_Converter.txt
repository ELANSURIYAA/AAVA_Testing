=============================================
Author:        Ascendion AVA+
Created on:   
Description:   Snowflake-compatible script to create or recreate a backup of Employee master data, keyed by EmployeeNo, for troubleshooting, point-in-time comparison, and recovery use-cases.
=============================================

-- Snowflake-Compatible Query:
```sql
-- Drop backup table if it exists
DROP TABLE IF EXISTS employee_bkup;

-- Create backup table
CREATE TABLE employee_bkup (
    EmployeeNo INT NOT NULL PRIMARY KEY,
    FirstName STRING NOT NULL,
    LastName STRING NOT NULL,
    DepartmentNo SMALLINT,
    NetPay INT
);

-- Populate the backup table if Employee table has rows
-- In Snowflake, use a conditional approach with a transaction block

-- Check if Employee table has rows and insert if so
-- Snowflake does not support procedural IF EXISTS in pure SQL, so use a multi-step approach

-- Step 1: Check row count
-- Step 2: If rows exist, insert; else, drop the backup table

-- Step 1: Get row count
-- (You can run this as a separate query if using the worksheet UI)
SELECT COUNT(*) AS EMPLOYEE_ROW_COUNT FROM Employee;

-- Step 2: Insert data if rows exist
-- (Assume row count > 0; otherwise, skip this step)
INSERT INTO employee_bkup (EmployeeNo, FirstName, LastName, DepartmentNo, NetPay)
SELECT
    e.EmployeeNo,
    e.FirstName,
    e.LastName,
    e.DepartmentNo,
    s.NetPay
FROM Employee AS e
INNER JOIN Salary AS s
    ON e.EmployeeNo = s.EmployeeNo;

-- Step 3: If Employee table is empty, drop the backup table
-- (Run this only if EMPLOYEE_ROW_COUNT = 0)
DROP TABLE IF EXISTS employee_bkup;

-- Notes:
-- - Snowflake does not support procedural blocks like BEGIN TRY...CATCH or IF EXISTS for DML in SQL scripts.
-- - For automation, use Snowflake Scripting (BEGIN ... END; with IF statements) or control flow in orchestration tools.
-- - All table names are unqualified; add schema if needed (e.g., public.Employee).
-- - Data types mapped: CHAR(30) -> STRING, INT -> INT, SMALLINT -> SMALLINT.
-- - PRIMARY KEY is for documentation; Snowflake does not enforce PK constraints but allows definition for metadata.

-- Example Snowflake Scripting block (if using Snowflake Scripting):

-- BEGIN
--     IF (SELECT COUNT(*) FROM Employee) > 0 THEN
--         INSERT INTO employee_bkup (EmployeeNo, FirstName, LastName, DepartmentNo, NetPay)
--         SELECT
--             e.EmployeeNo,
--             e.FirstName,
--             e.LastName,
--             e.DepartmentNo,
--             s.NetPay
--         FROM Employee AS e
--         INNER JOIN Salary AS s
--             ON e.EmployeeNo = s.EmployeeNo;
--     ELSE
--         DROP TABLE IF EXISTS employee_bkup;
--     END IF;
-- END;

```

API Cost Calculations
apiCost: 0.0042 USD