=============================================
Author:        Ascendion AVA+
Created on:   
Description:   Snowflake-compatible SQL script to create or recreate a backup of Employee master data, keyed by EmployeeNo, for troubleshooting, point-in-time comparison, and recovery use-cases.
=============================================

1. Test Case List:
| Test ID | Test Description | Input Data | Expected Output |
|--------|------------------|------------|-----------------|
| TC01 | Happy path: Employees with matching salary records | EMPLOYEE: [{EmployeeNo: 1, FirstName: 'John', LastName: 'Doe', DepartmentNo: 10}, {EmployeeNo: 2, FirstName: 'Jane', LastName: 'Smith', DepartmentNo: 20}]<br>SALARY: [{EmployeeNo: 1, Salary: 50000.00}, {EmployeeNo: 2, Salary: 60000.00}] | EMPLOYEE_BKUP: [{EmployeeNo: 1, FirstName: 'John', LastName: 'Doe', DepartmentNo: 10, Salary: 50000.00}, {EmployeeNo: 2, FirstName: 'Jane', LastName: 'Smith', DepartmentNo: 20, Salary: 60000.00}] |
| TC02 | Edge case: Employee with no matching salary record | EMPLOYEE: [{EmployeeNo: 3, FirstName: 'Alice', LastName: 'Brown', DepartmentNo: 30}]<br>SALARY: [] | EMPLOYEE_BKUP: [] |
| TC03 | Edge case: Salary record with no matching employee | EMPLOYEE: []<br>SALARY: [{EmployeeNo: 4, Salary: 70000.00}] | EMPLOYEE_BKUP: [] |
| TC04 | Boundary case: Salary is 0.00 | EMPLOYEE: [{EmployeeNo: 5, FirstName: 'Bob', LastName: 'White', DepartmentNo: 40}]<br>SALARY: [{EmployeeNo: 5, Salary: 0.00}] | EMPLOYEE_BKUP: [{EmployeeNo: 5, FirstName: 'Bob', LastName: 'White', DepartmentNo: 40, Salary: 0.00}] |
| TC05 | Error handling: Duplicate EmployeeNo in EMPLOYEE | EMPLOYEE: [{EmployeeNo: 6, FirstName: 'Sam', LastName: 'Green', DepartmentNo: 50}, {EmployeeNo: 6, FirstName: 'Samuel', LastName: 'Green', DepartmentNo: 50}]<br>SALARY: [{EmployeeNo: 6, Salary: 80000.00}] | Error: Duplicate EmployeeNo violates PRIMARY KEY constraint |
| TC06 | Null values: Null FirstName and LastName | EMPLOYEE: [{EmployeeNo: 7, FirstName: None, LastName: None, DepartmentNo: 60}]<br>SALARY: [{EmployeeNo: 7, Salary: 90000.00}] | EMPLOYEE_BKUP: [{EmployeeNo: 7, FirstName: None, LastName: None, DepartmentNo: 60, Salary: 90000.00}] |
| TC07 | Null values: Null Salary | EMPLOYEE: [{EmployeeNo: 8, FirstName: 'Eve', LastName: 'Black', DepartmentNo: 70}]<br>SALARY: [{EmployeeNo: 8, Salary: None}] | EMPLOYEE_BKUP: [{EmployeeNo: 8, FirstName: 'Eve', LastName: 'Black', DepartmentNo: 70, Salary: None}] |
| TC08 | Empty input tables | EMPLOYEE: []<br>SALARY: [] | EMPLOYEE_BKUP: [] |
| TC09 | Performance: Large dataset join | EMPLOYEE: 10,000 rows<br>SALARY: 10,000 rows (matching EmployeeNo) | EMPLOYEE_BKUP: 10,000 rows, join completes within reasonable time (e.g., < 2 seconds) |
| TC10 | Data integrity: All joined records have correct fields | EMPLOYEE: [{EmployeeNo: 9, FirstName: 'Tom', LastName: 'Jones', DepartmentNo: 80}]<br>SALARY: [{EmployeeNo: 9, Salary: 100000.00}] | EMPLOYEE_BKUP: [{EmployeeNo: 9, FirstName: 'Tom', LastName: 'Jones', DepartmentNo: 80, Salary: 100000.00}] |

2. Pytest Script for each test case

```python
import pytest
import snowflake.connector

# Helper function to set up tables
def setup_tables(conn, employee_data, salary_data):
    cur = conn.cursor()
    cur.execute("DROP TABLE IF EXISTS EMPLOYEE_BKUP")
    cur.execute("DROP TABLE IF EXISTS EMPLOYEE")
    cur.execute("DROP TABLE IF EXISTS SALARY")
    cur.execute("""
        CREATE TABLE EMPLOYEE (
            EmployeeNo INT,
            FirstName STRING,
            LastName STRING,
            DepartmentNo INT
        )
    """)
    cur.execute("""
        CREATE TABLE SALARY (
            EmployeeNo INT,
            Salary NUMBER(18,2)
        )
    """)
    for emp in employee_data:
        cur.execute(
            "INSERT INTO EMPLOYEE VALUES (%s, %s, %s, %s)",
            (emp['EmployeeNo'], emp['FirstName'], emp['LastName'], emp['DepartmentNo'])
        )
    for sal in salary_data:
        cur.execute(
            "INSERT INTO SALARY VALUES (%s, %s)",
            (sal['EmployeeNo'], sal['Salary'])
        )
    cur.close()

# Helper function to run the backup SQL
def run_backup_sql(conn):
    cur = conn.cursor()
    cur.execute("DROP TABLE IF EXISTS EMPLOYEE_BKUP")
    cur.execute("""
        CREATE TABLE EMPLOYEE_BKUP (
            EmployeeNo INT PRIMARY KEY,
            FirstName STRING,
            LastName STRING,
            DepartmentNo INT,
            Salary NUMBER(18,2)
        )
    """)
    cur.execute("""
        INSERT INTO EMPLOYEE_BKUP (EmployeeNo, FirstName, LastName, DepartmentNo, Salary)
        SELECT E.EmployeeNo, E.FirstName, E.LastName, E.DepartmentNo, S.Salary
        FROM EMPLOYEE E
        INNER JOIN SALARY S ON E.EmployeeNo = S.EmployeeNo
    """)
    cur.close()

# Helper function to fetch results
def fetch_bkup(conn):
    cur = conn.cursor()
    cur.execute("SELECT * FROM EMPLOYEE_BKUP ORDER BY EmployeeNo")
    results = cur.fetchall()
    cur.close()
    return results

@pytest.fixture(scope="function")
def snowflake_conn():
    conn = snowflake.connector.connect(
        user='YOUR_USER',
        password='YOUR_PASSWORD',
        account='YOUR_ACCOUNT',
        warehouse='YOUR_WAREHOUSE',
        database='YOUR_DATABASE',
        schema='YOUR_SCHEMA'
    )
    yield conn
    conn.close()

# TC01: Happy path
def test_happy_path(snowflake_conn):
    """Test that employees with matching salary records are correctly backed up."""
    setup_tables(
        snowflake_conn,
        [{'EmployeeNo': 1, 'FirstName': 'John', 'LastName': 'Doe', 'DepartmentNo': 10},
         {'EmployeeNo': 2, 'FirstName': 'Jane', 'LastName': 'Smith', 'DepartmentNo': 20}],
        [{'EmployeeNo': 1, 'Salary': 50000.00}, {'EmployeeNo': 2, 'Salary': 60000.00}]
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == [
        (1, 'John', 'Doe', 10, 50000.00),
        (2, 'Jane', 'Smith', 20, 60000.00)
    ]

# TC02: Employee with no matching salary record
def test_employee_no_salary(snowflake_conn):
    """Test that employees without salary records are not backed up."""
    setup_tables(
        snowflake_conn,
        [{'EmployeeNo': 3, 'FirstName': 'Alice', 'LastName': 'Brown', 'DepartmentNo': 30}],
        []
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == []

# TC03: Salary record with no matching employee
def test_salary_no_employee(snowflake_conn):
    """Test that salary records without matching employees are not backed up."""
    setup_tables(
        snowflake_conn,
        [],
        [{'EmployeeNo': 4, 'Salary': 70000.00}]
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == []

# TC04: Salary is 0.00
def test_salary_zero(snowflake_conn):
    """Test that salary of 0.00 is correctly backed up."""
    setup_tables(
        snowflake_conn,
        [{'EmployeeNo': 5, 'FirstName': 'Bob', 'LastName': 'White', 'DepartmentNo': 40}],
        [{'EmployeeNo': 5, 'Salary': 0.00}]
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == [(5, 'Bob', 'White', 40, 0.00)]

# TC05: Duplicate EmployeeNo in EMPLOYEE
def test_duplicate_employee_no(snowflake_conn):
    """Test that duplicate EmployeeNo in EMPLOYEE raises an error due to PRIMARY KEY constraint."""
    setup_tables(
        snowflake_conn,
        [{'EmployeeNo': 6, 'FirstName': 'Sam', 'LastName': 'Green', 'DepartmentNo': 50},
         {'EmployeeNo': 6, 'FirstName': 'Samuel', 'LastName': 'Green', 'DepartmentNo': 50}],
        [{'EmployeeNo': 6, 'Salary': 80000.00}]
    )
    with pytest.raises(Exception):
        run_backup_sql(snowflake_conn)

# TC06: Null FirstName and LastName
def test_null_names(snowflake_conn):
    """Test that null FirstName and LastName are handled correctly."""
    setup_tables(
        snowflake_conn,
        [{'EmployeeNo': 7, 'FirstName': None, 'LastName': None, 'DepartmentNo': 60}],
        [{'EmployeeNo': 7, 'Salary': 90000.00}]
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == [(7, None, None, 60, 90000.00)]

# TC07: Null Salary
def test_null_salary(snowflake_conn):
    """Test that null Salary is handled correctly."""
    setup_tables(
        snowflake_conn,
        [{'EmployeeNo': 8, 'FirstName': 'Eve', 'LastName': 'Black', 'DepartmentNo': 70}],
        [{'EmployeeNo': 8, 'Salary': None}]
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == [(8, 'Eve', 'Black', 70, None)]

# TC08: Empty input tables
def test_empty_tables(snowflake_conn):
    """Test that empty input tables result in an empty backup table."""
    setup_tables(
        snowflake_conn,
        [],
        []
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == []

# TC09: Performance test with large dataset
def test_large_dataset_performance(snowflake_conn):
    """Test performance with large dataset."""
    import time
    employee_data = [{'EmployeeNo': i, 'FirstName': f'First{i}', 'LastName': f'Last{i}', 'DepartmentNo': i % 10} for i in range(1, 10001)]
    salary_data = [{'EmployeeNo': i, 'Salary': float(i * 1000)} for i in range(1, 10001)]
    setup_tables(snowflake_conn, employee_data, salary_data)
    start = time.time()
    run_backup_sql(snowflake_conn)
    elapsed = time.time() - start
    results = fetch_bkup(snowflake_conn)
    assert len(results) == 10000
    assert elapsed < 2.0  # seconds

# TC10: Data integrity
def test_data_integrity(snowflake_conn):
    """Test that all fields are correctly joined and backed up."""
    setup_tables(
        snowflake_conn,
        [{'EmployeeNo': 9, 'FirstName': 'Tom', 'LastName': 'Jones', 'DepartmentNo': 80}],
        [{'EmployeeNo': 9, 'Salary': 100000.00}]
    )
    run_backup_sql(snowflake_conn)
    results = fetch_bkup(snowflake_conn)
    assert results == [(9, 'Tom', 'Jones', 80, 100000.00)]
```

3. API Cost Calculation

apiCost: 0.0042 USD