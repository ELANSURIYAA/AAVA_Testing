=============================================
Author:        Ascendion AVA+
Date:   
Description:   Documentation for SSIS Package EDW_BC_Load_DimBillingAccount â€“ ETL for DimBillingAccount dimension loading and updating.
=============================================

1. Overview of Package:
The SSIS package EDW_BC_Load_DimBillingAccount is designed to extract, transform, and load (ETL) data into the DimBillingAccount dimension table. It sources data from GuideWire and related tables, performs business logic to determine updates or inserts, and ensures the DimBillingAccount table reflects the latest account information. This ETL process is a critical part of the enterprise data warehouse, supporting accurate reporting and analytics for billing accounts. The business use case addressed is maintaining up-to-date billing account dimension data for downstream reporting, analytics, and operational processes.

High-level package components:
- Control Flow: Manages sequence and error handling for ETL steps.
- Data Flow: Implements extraction, transformation, and loading logic.
- Variables: Tracks counts (InsertCount, UpdateCount, UnChangeCount, SourceCount), BatchID, and process state.

2. Package Design and Structure:
The package is modular, with clear separation of tasks:
- Sequence Containers: Not explicitly shown, but logical grouping via task naming.
- Data Flow Task: "DFT - Load DimBillingAccount" is the central ETL pipeline.
- Control Flow Elements:
  - SQL- Initiate Process: Marks start of ETL.
  - DFT - Load DimBillingAccount: Executes the main data flow.
  - SQL - Conclude Process Completed/Failed: Marks process completion or failure.
  - Event Handlers: OnError logging.
- Key SSIS Components:
  - Source: OLE_SRC - GuideWire (complex SQL query joining multiple tables).
  - Lookup: LKP - DimBillingAccount (matches incoming rows to existing dimension records).
  - Conditional Split: CSPL - Check BeanVersion (determines update/insert/unchanged logic).
  - Derived Columns: DRV - BatchID & Legacy (adds BatchID, LegacySourceSystem).
  - Execute SQL Task: CMD - Update DimBillingAccount (updates existing records).
  - Data Flow Tasks: Load DimBillingAccount (inserts new records).
  - Row Count: CNT - Source Count, CNT - Insert Count, CNT - Update Count, CNT - Unchange Count (tracks ETL metrics).

3. Data Flow and Transformation Logic:
- Extraction: OLE_SRC - GuideWire uses a complex SQL query to pull billing account data, joining bc_account, bc_ParentAcct, bc_accountcontact, bc_contact, bc_address, bctl_state, and other lookup tables. Filters are applied to select records updated within a configurable date range.
- Lookup: LKP - DimBillingAccount matches incoming records to DimBillingAccount using PublicID and BeanVersion.
- Derived Column: DRV - BatchID & Legacy adds BatchID (from variable) and sets LegacySourceSystem to 'WC'.
- Conditional Split: CSPL - Check BeanVersion compares BeanVersion between source and target. If same, marks as unchanged; if different, routes to update logic.
- Insert: Load DimBillingAccount inserts new records where no match is found.
- Update: CMD - Update DimBillingAccount updates records where BeanVersion differs.
- Row Count: Each path tracks counts for source, inserts, updates, unchanged for monitoring and auditing.
- Data Cleansing/Validation: Data type conversions (CAST), concatenations, and conditional logic (CASE for IsActive).
- Filtering: Only records with updates in the past N days are processed (parameterized date filtering).
- Business Rules: IsActive flag based on Retired status; BeanVersion concatenation for change tracking.

4. Data Mapping:
Target Table Name : DimBillingAccount
Mappings (sample, full mapping available from SQL query and update statement):

| Target Column Name           | Source Table Name    | Source Column Name            | Remarks                           |
|-----------------------------|----------------------|-------------------------------|------------------------------------|
| AccountCloseDate            | bc_account           | CloseDate                     | 1 to 1 mapping                    |
| AccountCreationDate         | bc_account           | CreateTime                    | 1 to 1 mapping                    |
| AccountName                 | bc_account           | AccountName                   | 1 to 1 mapping                    |
| AccountNumber               | bc_account           | AccountNumber                 | 1 to 1 mapping                    |
| AccountTypeName             | bctl_accounttype     | NAME                          | Transformation (lookup)           |
| AddressLine1                | bc_address           | AddressLine1                  | 1 to 1 mapping                    |
| AddressLine2                | bc_address           | AddressLine2                  | 1 to 1 mapping                    |
| AddressLine3                | bc_address           | AddressLine3                  | 1 to 1 mapping                    |
| BatchId                     | SSIS Variable        | BatchID                       | Transformation (from variable)     |
| BeanVersion                 | Multiple             | CONCAT(dt.BeanVersion,...)    | Transformation (concatenation)     |
| BillingLevelName            | bctl_billinglevel    | NAME                          | Transformation (lookup)            |
| City                        | bc_address           | City                          | 1 to 1 mapping                    |
| DeliquencyStatusName        | bctl_delinquencystatus| NAME                         | Transformation (lookup)            |
| FirstName                   | bc_contact           | FirstName                     | 1 to 1 mapping                    |
| GWRowNumber                 | bc_account           | ID                            | 1 to 1 mapping                    |
| IsActive                    | bc_account           | Retired (CASE logic)          | Validation/Transformation          |
| LastName                    | bc_contact           | LastName                      | 1 to 1 mapping                    |
| ParentAccountNumber         | bc_ParentAcct        | AccountNumber                 | Transformation (lookup)            |
| PostalCode                  | bc_address           | PostalCode                    | 1 to 1 mapping                    |
| SecurityZone                | bc_securityzone      | Name                          | Transformation (lookup)            |
| Segment                     | bctl_accountsegment  | NAME                          | Transformation (lookup)            |
| ServiceTierName             | bctl_customerservicetier| NAME                        | Transformation (lookup)            |
| State                       | bctl_state           | NAME                          | Transformation (lookup)            |
| PublicID                    | bc_account           | PublicID                      | 1 to 1 mapping                    |
| LegacySourceSystem          | Derived              | 'WC'                          | Transformation (constant)          |

5. Key Outputs:
- Inserts: New records are inserted into DimBillingAccount for accounts not previously present (determined by Lookup No Match).
- Updates: Existing records are updated where BeanVersion has changed (determined by Conditional Split).
- Unchanged: Records with same BeanVersion are tracked but not modified.
- Counts: InsertCount, UpdateCount, UnChangeCount, SourceCount variables are updated for monitoring and auditing.
- Outputs align with business goals by ensuring DimBillingAccount contains the latest, most accurate account information for reporting and analytics. The process supports operational needs for billing, customer management, and compliance.

6. apiCost: float
apiCost: 0.00000000 USD

This documentation provides a comprehensive guide for business and technical stakeholders to understand, maintain, and modernize the EDW_BC_Load_DimBillingAccount SSIS package.