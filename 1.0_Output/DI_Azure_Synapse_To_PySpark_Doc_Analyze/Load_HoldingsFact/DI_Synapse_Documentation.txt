# Azure Synapse Documentation: Load Fact Executive Summary

---

**Current Task:**  
====================================================  
Author:        Ascendion AAVA  
Date:            
Description:   Load summarized holding metrics into FACT_EXECUTIVE_SUMMARY from staging and dimension tables  
====================================================  

## 1. Overview of Pipeline/Component

The `LOAD_FACT_EXECUTIVE_SUMMARY` stored procedure in Azure Synapse Analytics loads the `FACT_EXECUTIVE_SUMMARY` fact table with aggregated holding metrics sourced from the `STG_HOLDING_METRICS` staging table. It performs data quality checks, applies business rules, and ensures referential integrity by joining with dimension tables (`DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`). This process supports executive reporting and analytics by providing a cleansed, validated, and enriched summary of holdings data.

## 2. Component Structure and Design

- **Source:**  
  - `STG_HOLDING_METRICS` (staging table for holding metrics)
  - Dimension tables: `DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`
- **Transformation:**  
  - Temporary staging table `#staging_metrics` is created from `STG_HOLDING_METRICS`
  - Business rule: `income_amount` is set to 0 if null or negative
  - Joins to dimension tables for referential integrity
- **Sink:**  
  - `FACT_EXECUTIVE_SUMMARY` (fact table)
- **Activities:**  
  - Data validation, transformation, and loading
  - Audit logging (row count)
  - Cleanup of temp tables
- **Parameters/Variables:**  
  - `@v_row_count` (row count for audit)
  - `@error_message` (not used in logic, reserved for error handling)
- **Orchestration:**  
  - Designed as a stored procedure, typically invoked by a Synapse pipeline activity (not shown in artifact)

## 3. Data Flow and Processing Logic

- **Processed Datasets:**  
  - `STG_HOLDING_METRICS`
  - `DIM_DATE`
  - `DIM_INSTITUTION`
  - `DIM_CORPORATION`
  - `DIM_PRODUCT`
  - `FACT_EXECUTIVE_SUMMARY`

- **Data Flow:**  
  1. Data is selected from `STG_HOLDING_METRICS` into a temp table `#staging_metrics`.
  2. Records are joined with dimension tables to ensure referential integrity.
  3. Business rules are applied (e.g., handling of `income_amount`).
  4. Validated and enriched records are inserted into `FACT_EXECUTIVE_SUMMARY`.
  5. Audit logging captures the number of inserted records.
  6. Temporary resources are cleaned up.

- **Business Rules/Transformations:**  
  - `income_amount` is set to 0 if null or negative.
  - Only records with matching dimension keys are loaded.

- **SQL Scripts/Stored Procedures Used:**  
  - `dbo.LOAD_FACT_EXECUTIVE_SUMMARY` (main logic)

## 4. Data Mapping (Lineage)

| Target Table Name      | Target Column Name      | Source Table Name      | Source Column Name      | Remarks                                                                 |
|-----------------------|------------------------|-----------------------|------------------------|-------------------------------------------------------------------------|
| FACT_EXECUTIVE_SUMMARY| date_key               | DIM_DATE              | date_key               | 1:1 Mapping via join on stg.date_value                                  |
| FACT_EXECUTIVE_SUMMARY| institution_id         | DIM_INSTITUTION       | institution_id         | 1:1 Mapping via join on stg.institution_id                              |
| FACT_EXECUTIVE_SUMMARY| corporation_id         | DIM_CORPORATION       | corporation_id         | 1:1 Mapping via join on stg.corporation_id                              |
| FACT_EXECUTIVE_SUMMARY| product_id             | DIM_PRODUCT           | product_id             | 1:1 Mapping via join on stg.product_id                                  |
| FACT_EXECUTIVE_SUMMARY| a120_amount            | #staging_metrics      | a120_amount            | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| a120_count             | #staging_metrics      | a120_count             | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| a30_to_59_amount       | #staging_metrics      | a30_to_59_amount       | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| a30_to_59_count        | #staging_metrics      | a30_to_59_count        | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| a60_to_89_amount       | #staging_metrics      | a60_to_89_amount       | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| a60_to_89_count        | #staging_metrics      | a60_to_89_count        | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| a90_to_119_amount      | #staging_metrics      | a90_to_119_amount      | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| a90_to_119_count       | #staging_metrics      | a90_to_119_count       | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| charge_off_amount      | #staging_metrics      | charge_off_amount      | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| charge_off_count       | #staging_metrics      | charge_off_count       | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| fraud_amount           | #staging_metrics      | fraud_amount           | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| fraud_count            | #staging_metrics      | fraud_count            | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| income_amount          | #staging_metrics      | income_amount          | Transformation: If NULL or <0, set to 0                                 |
| FACT_EXECUTIVE_SUMMARY| number_of_accounts     | #staging_metrics      | number_of_accounts     | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| purchases_amount       | #staging_metrics      | purchases_amount       | 1:1 Mapping                                                             |
| FACT_EXECUTIVE_SUMMARY| purchases_count        | #staging_metrics      | purchases_count        | 1:1 Mapping                                                             |

## 5. Transformation Logic

- **Derived/Computed Columns:**
  - `income_amount`:  
    ```
    CASE 
        WHEN stg.income_amount IS NULL OR stg.income_amount < 0 THEN 0
        ELSE stg.income_amount
    END AS income_amount
    ```
    *Sets `income_amount` to 0 if null or negative, otherwise uses the original value.*

- **Joins for Referential Integrity:**  
  - `INNER JOIN` to each dimension table ensures only valid dimension keys are loaded.

- **Audit Logging:**  
  - Captures and prints the number of records inserted.

- **Cleanup:**  
  - Drops temporary table after use.

- **No UDFs or reusable templates are used in this stored procedure.**

## 6. Complexity Analysis

| Metric                              | Value/Details                                                        |
|--------------------------------------|---------------------------------------------------------------------|
| Number of Pipeline Activities        | 1 (Stored Procedure)                                                |
| Number of Dataflow Transformations   | 1 (Business rule on income_amount)                                  |
| SQL Scripts or Stored Procedures Used| 1 (`LOAD_FACT_EXECUTIVE_SUMMARY`)                                   |
| Joins Used                          | 4 (`INNER JOIN` to DIM_DATE, DIM_INSTITUTION, DIM_CORPORATION, DIM_PRODUCT) |
| Lookup Tables or Reference Data      | 4 (Dimension tables)                                                |
| Parameters/Variables/Triggers        | 2 variables (`@v_row_count`, `@error_message`)                      |
| Number of Output Datasets            | 1 (`FACT_EXECUTIVE_SUMMARY`)                                        |
| Conditional Logic or if-else Flows   | 1 (CASE for income_amount)                                          |
| External Dependencies                | Dimension tables, staging table                                     |
| Overall Complexity Score             | 30                                                                  |

## 7. Key Outputs

- **Output Table:** `FACT_EXECUTIVE_SUMMARY`
- **Format:** Synapse Table (columnar storage, optimized for analytics)
- **Intended Use:** Executive reporting, regulatory reporting, downstream analytics, and business intelligence dashboards.

---

**API Cost:**  
apiCost: 0.005 USD

---