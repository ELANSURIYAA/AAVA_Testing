```
=============================================
Author:        Ascendion AVA+
Date:   
Description:   Documentation for the SSIS package that loads and updates the DimBillingAccount dimension table from GuideWire source systems, including all control flow, data flow, transformation logic, and data mapping.
=============================================

1. Overview of Package

Purpose:
This SSIS package, "EDW_BC_Load_DimBillingAccount.dtsx", is designed to extract, transform, and load (ETL) data into the DimBillingAccount dimension table from various GuideWire source tables. It supports both insert and update operations, ensuring that the DimBillingAccount table in the enterprise data warehouse (EDW) remains current and accurate.

Broader Data Integration/Warehousing Strategy:
The package is a key component in the EDW’s dimensional modeling strategy, supporting downstream analytics, reporting, and business intelligence by maintaining a clean, up-to-date billing account dimension. It ensures data consistency, supports historical tracking, and aligns with the organization’s single source of truth for billing accounts.

Business Use Case:
The package addresses the business need to have a consolidated, accurate, and timely view of all billing accounts, including their attributes, hierarchies, and status, for financial reporting, customer analytics, and operational processes.

High-Level Package Components:
- Control Flow: Orchestrates the ETL process, including initialization, data flow execution, and process completion/failure handling.
- Data Flow: Handles extraction from GuideWire, transformation, lookups, conditional splits, and loading into DimBillingAccount.
- Variables: Manages batch IDs, row counts, and process state.
- Event Handlers: Captures and logs errors for auditing and troubleshooting.

2. Package Design and Structure

Design and Modular Layout:
- Sequence of tasks: Initialization (SQL- Initiate Process) → Data Flow Task (DFT - Load DimBillingAccount) → Completion or Failure (SQL - Conclude Process Completed/Failed).
- Event handlers for error logging.

Key SSIS Components:
- Source/Destination Components:
  - OLE DB Source: Extracts data from GuideWire source tables via a complex SQL query.
  - OLE DB Destination: Loads data into [dbo].[DimBillingAccount].
- Lookups:
  - LKP - DimBillingAccount: Looks up existing records in DimBillingAccount to determine insert/update logic.
- Conditional Split:
  - CSPL - Check BeanVersion: Splits rows based on BeanVersion comparison to identify unchanged, new, or updated records.
- Derived Columns:
  - DRV - BatchID & Legacy: Adds/derives BatchID and LegacySourceSystem columns.
- Aggregations:
  - Row Count components (CNT - Source Count, CNT - Insert Count, CNT - Update Count, CNT - Unchange Count): Track ETL metrics.
- Execute SQL Tasks:
  - SQL- Initiate Process, SQL - Conclude Process Completed/Failed: Manage process state in metadata/audit tables.
- Data Flow Tasks:
  - DFT - Load DimBillingAccount: Main ETL logic.
- Control Flow Elements:
  - Precedence constraints to manage task execution order and error handling.

3. Data Flow and Transformation Logic

Data Flow Paths and Major Transformations:

- OLE_SRC - GuideWire (Source Extraction):
  - Extracts a comprehensive set of billing account attributes from multiple GuideWire tables using a complex SQL statement with CTEs (ParentAcct, InsuredInfo) and multiple LEFT JOINs.
  - Applies filters to extract only records updated within the last N days, based on UpdateTime fields across related tables.

- DRV - BatchID & Legacy (Derived Columns):
  - Adds BatchID (from variable @[User::BatchID]) and sets LegacySourceSystem to 'WC' for all rows.

- LKP - DimBillingAccount (Lookup):
  - Looks up existing DimBillingAccount records using PublicID and LegacySourceSystem to determine if the incoming record is new or an update.

- CSPL - Check BeanVersion (Conditional Split):
  - Compares BeanVersion from source and target.
    - If BeanVersion matches, row is considered unchanged.
    - If BeanVersion differs, row is considered an update.
    - If no match, row is considered a new insert.

- Load DimBillingAccount (OLE DB Destination):
  - Inserts new records into [dbo].[DimBillingAccount].

- CMD - Update DimBillingAccount (OLE DB Command):
  - Updates existing records in [dbo].[DimBillingAccount] where BeanVersion has changed.

- Row Count Components:
  - Track the number of source, inserted, updated, and unchanged rows for auditing and monitoring.

Filtering, Joins, Business Rules, and Data Cleansing:
- Filtering: Only records updated within the last N days are processed.
- Joins: Multiple joins to enrich billing account data with parent account, insured info, address, state, billing level, segment, service tier, and delinquency status.
- Business Rules: IsActive is derived from the Retired flag; LegacySourceSystem is hardcoded as 'WC'.
- Data Cleansing: Data type conversions (e.g., CAST to VARCHAR), handling of nulls via LEFT JOINs.

Data Type Conversions/Validations:
- Explicit CASTs in SQL for string columns.
- Data type mapping in SSIS components (e.g., DT_STR for PublicID, BeanVersion).

4. Data Mapping

Below is a structured lineage of source-to-target mappings:

| Target Table Name      | Target Column Name                  | Source Table Name         | Source Column Name                | Remarks                                              |
|-----------------------|-------------------------------------|--------------------------|-----------------------------------|------------------------------------------------------|
| DimBillingAccount     | AccountCloseDate                    | bc_account               | CloseDate                         | 1 to 1 mapping                                       |
| DimBillingAccount     | AccountCreationDate                 | bc_account               | CreateTime                        | 1 to 1 mapping                                       |
| DimBillingAccount     | AccountName                         | bc_account               | AccountName                       | 1 to 1 mapping                                       |
| DimBillingAccount     | AccountNumber                       | bc_account               | AccountNumber                     | 1 to 1 mapping                                       |
| DimBillingAccount     | AccountTypeName                     | bctl_accounttype         | NAME                              | Transformation (join and cast to VARCHAR(50))         |
| DimBillingAccount     | AddressLine1                        | bc_address (InsuredInfo) | AddressLine1                      | Transformation (join via InsuredInfo)                 |
| DimBillingAccount     | AddressLine2                        | bc_address (InsuredInfo) | AddressLine2                      | Transformation (join via InsuredInfo)                 |
| DimBillingAccount     | AddressLine3                        | bc_address (InsuredInfo) | AddressLine3                      | Transformation (join via InsuredInfo)                 |
| DimBillingAccount     | BatchId                             | SSIS Variable            | @[User::BatchID]                  | Derived column                                        |
| DimBillingAccount     | BeanVersion                         | Multiple                 | CONCAT(dt.BeanVersion,...)        | Transformation (concatenation of BeanVersions)        |
| DimBillingAccount     | BillingLevelName                    | bctl_billinglevel        | NAME                              | Transformation (join and cast to VARCHAR(100))        |
| DimBillingAccount     | City                                | bc_address (InsuredInfo) | City                              | Transformation (join via InsuredInfo, cast to VARCHAR(50)) |
| DimBillingAccount     | DeliquencyStatusName                | bctl_delinquencystatus   | NAME                              | Transformation (join and cast to VARCHAR(50))         |
| DimBillingAccount     | FirstName                           | bc_contact (InsuredInfo) | FirstName                         | Transformation (join via InsuredInfo)                 |
| DimBillingAccount     | GWRowNumber                         | bc_account               | ID                                | 1 to 1 mapping                                       |
| DimBillingAccount     | IsActive                            | bc_account               | CASE Retired WHEN 0 THEN 1 ELSE 0 END | Transformation (business rule)                   |
| DimBillingAccount     | LastName                            | bc_contact (InsuredInfo) | LastName                          | Transformation (join via InsuredInfo)                 |
| DimBillingAccount     | ParentAccountNumber                 | ParentAcct               | ParentAccountNumber                | Transformation (join via ParentAcct CTE)              |
| DimBillingAccount     | PostalCode                          | bc_address (InsuredInfo) | PostalCode                        | Transformation (join via InsuredInfo, cast to VARCHAR(50)) |
| DimBillingAccount     | SecurityZone                        | bc_securityzone          | Name                              | Transformation (join and cast to VARCHAR)             |
| DimBillingAccount     | Segment                             | bctl_accountsegment      | NAME                              | Transformation (join and cast to VARCHAR(50))         |
| DimBillingAccount     | ServiceTierName                     | bctl_customerservicetier | NAME                              | Transformation (join and cast to VARCHAR(50))         |
| DimBillingAccount     | State                               | bctl_state (InsuredInfo) | NAME                              | Transformation (join via InsuredInfo, cast to VARCHAR(50)) |
| DimBillingAccount     | PublicID                            | bc_account               | PublicID                          | 1 to 1 mapping                                       |
| DimBillingAccount     | LegacySourceSystem                  | Derived                  | 'WC'                              | Derived column (constant value)                       |
| DimBillingAccount     | FirstTwicePerMonthInvoiceDayOfMonth | bc_account               | FirstTwicePerMthInvoiceDOM        | 1 to 1 mapping                                       |
| DimBillingAccount     | SecondTwicePerMonthInvoiceDayOfMonth| bc_account               | SecondTwicePerMthInvoiceDOM       | 1 to 1 mapping                                       |

(Additional columns are similarly mapped; see the SQL extraction logic for further details.)

5. Key Outputs

- Inserts: New billing account records are inserted into [dbo].[DimBillingAccount] when no matching PublicID and LegacySourceSystem are found.
- Updates: Existing records are updated in [dbo].[DimBillingAccount] when BeanVersion differs, reflecting changes in the source system.
- Unchanged: Records with identical BeanVersion are counted but not modified.
- Audit Outputs: Row counts for source, insert, update, and unchanged records are tracked for monitoring and reporting.

Alignment with Business Goals:
- Ensures the DimBillingAccount dimension is always current, supporting accurate reporting and analytics.
- Enables tracking of new and updated accounts for operational and compliance reporting.
- Supports data lineage and auditability through row counts and process logging.

6. apiCost: float

apiCost: 0.0000

```