=============================================
Author: Ascendion AAVA
Date:          
Description: Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

Based on the analysis of the `populate_dimensions` stored procedure, the estimated Fabric runtime cost breakdown is as follows:

**Estimated Monthly Runtime Cost: $45 - $75 USD**

**Cost Justification:**

- **Complexity Assessment**: The stored procedure has a moderate complexity score of 35/100, involving 3 MERGE operations processing dimension tables with data quality filters
- **Data Volume Considerations**: Processing staging data (`STG_DIMENSION_DATA`) to populate 3 dimension tables (`DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`) with an estimated 10,000-50,000 records per dimension table monthly
- **Execution Frequency**: Assuming nightly execution (30 runs per month) as part of ETL pipeline orchestration
- **Fabric Compute Requirements**: 
  - Small to Medium Fabric capacity (F2-F4) estimated at $1.50-$2.50 per execution
  - Each execution estimated to run 15-20 minutes including data loading and validation
- **Performance Optimizations**: MERGE operations with DISTINCT clauses and filtering logic will benefit from Fabric's distributed processing, potentially reducing execution time by 20-30% compared to Synapse

**Cost Breakdown:**
- Fabric Compute Units: $40-$65/month
- Data Storage (incremental): $3-$7/month  
- Network/Data Movement: $2-$3/month

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Estimated Manual Fix Effort: 16-20 hours**

**Effort Breakdown:**

- **Stored Procedure to Fabric Pipeline Conversion (6-8 hours)**:
  - Convert stored procedure structure to Fabric notebook or pipeline activities
  - Implement proper orchestration logic for sequential MERGE operations
  - Replace PRINT statements with appropriate Fabric logging mechanisms

- **MERGE Statement Optimization (4-5 hours)**:
  - Optimize 3 MERGE operations for Fabric's distributed architecture
  - Implement predicate pushdown for filtering conditions
  - Handle schema references and adjust `dbo.` prefixes as needed

- **Business Logic Implementation (3-4 hours)**:
  - Institution ID validation: `institution_id IS NOT NULL AND LEN(institution_id) > 3`
  - Corporation filtering: `UPPER(corporation_name) NOT LIKE 'TEST%'`
  - Product exclusion: `processing_group NOT IN ('DEPRECATED', 'LEGACY')`

- **Error Handling and Transaction Management (3 hours)**:
  - Implement comprehensive error handling using Fabric pipeline mechanisms
  - Add transaction boundaries for data consistency
  - Establish proper dependency management and sequencing

#### 2.2 Output Validation Effort

**Estimated Validation Effort: 12-16 hours**

**Validation Activities:**

- **Data Reconciliation Testing (6-8 hours)**:
  - Compare row counts between Synapse and Fabric outputs for all 3 dimension tables
  - Validate data quality filters are applied correctly
  - Verify MERGE logic produces identical results

- **Business Rule Validation (4-5 hours)**:
  - Test institution ID length and null filtering
  - Validate corporation name TEST exclusion logic
  - Confirm product deprecation/legacy filtering

- **Performance and Integration Testing (2-3 hours)**:
  - Validate execution time and resource consumption
  - Test pipeline integration and dependency handling
  - Verify logging and monitoring functionality

#### 2.3 Total Estimated Effort in Hours

**Total Estimated Effort: 28-36 hours**

**Effort Calculation:**
- Manual Code Fixes: 16-20 hours
- Output Validation: 12-16 hours
- **Total Range: 28-36 hours**

**Justification:**
The total effort accounts for the moderate complexity of the stored procedure (complexity score 35/100), the need to convert 3 MERGE operations with different filtering logic, and comprehensive testing to ensure data quality and business rule compliance. The effort includes overlap considerations for integrated testing and validation activities.

---

### 3. API Cost Consumption

```
apiCost: 0.0025 USD
```