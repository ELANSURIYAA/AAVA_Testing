# Azure Synapse Component Documentation

---

## ====================================================
**Author:**        Ascendion AAVA  
**Date:**          <leave it blank>  
**Description:**   Loads the FACT_EXECUTIVE_SUMMARY table with summarized holding metrics from staging, applying business rules and referential integrity checks.
====================================================

---

## 1. Overview of Pipeline/Component

This stored procedure, `dbo.LOAD_FACT_EXECUTIVE_SUMMARY`, is designed to populate the `FACT_EXECUTIVE_SUMMARY` fact table within Synapse Data Warehouse. It ingests data from the staging table `STG_HOLDING_METRICS`, applies data quality validations and business rules, and ensures referential integrity by joining with dimension tables. The procedure supports regulatory reporting and executive analytics by providing a cleansed, summarized snapshot of holding metrics.

---

## 2. Component Structure and Design

- **Component Type:** SQL Stored Procedure (`dbo.LOAD_FACT_EXECUTIVE_SUMMARY`)
- **Source:** `dbo.STG_HOLDING_METRICS` (staging table)
- **Transformation Logic:** Temporary table creation, business rule enforcement, referential integrity via joins, and conditional logic for data quality.
- **Target/Sink:** `dbo.FACT_EXECUTIVE_SUMMARY` (fact table)
- **Key Activities:**
  - Staging data preparation (temp table)
  - Data validation and transformation
  - Joins to dimension tables: `DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`
  - Insert into fact table
  - Audit logging (row count)
  - Cleanup (drop temp table)
- **Parameters/Variables:** Local variables for row count and error messages.
- **Triggers:** Not specified in the code; typically invoked as part of a Synapse pipeline or scheduled job.

---

## 3. Data Flow and Processing Logic

**Processed Datasets:**
- `dbo.STG_HOLDING_METRICS`
- `dbo.DIM_DATE`
- `dbo.DIM_INSTITUTION`
- `dbo.DIM_CORPORATION`
- `dbo.DIM_PRODUCT`
- `dbo.FACT_EXECUTIVE_SUMMARY`

**Data Flow:**
1. Data is selected from `STG_HOLDING_METRICS` into a temporary staging table.
2. The procedure joins staging data with dimension tables to enforce referential integrity.
3. Business rules (e.g., non-negative income amount) are applied.
4. Validated and transformed records are inserted into `FACT_EXECUTIVE_SUMMARY`.
5. Row count is logged for auditing.
6. Temporary resources are cleaned up.

---

## 4. Data Mapping (Lineage)

| Target Table Name         | Target Column Name      | Source Table Name         | Source Column Name      | Remarks                                                                 |
|--------------------------|------------------------|--------------------------|------------------------|-------------------------------------------------------------------------|
| FACT_EXECUTIVE_SUMMARY   | date_key               | DIM_DATE                 | date_key               | 1:1 Mapping via join on stg.date_value                                  |
| FACT_EXECUTIVE_SUMMARY   | institution_id         | DIM_INSTITUTION          | institution_id         | 1:1 Mapping via join on stg.institution_id                              |
| FACT_EXECUTIVE_SUMMARY   | corporation_id         | DIM_CORPORATION          | corporation_id         | 1:1 Mapping via join on stg.corporation_id                              |
| FACT_EXECUTIVE_SUMMARY   | product_id             | DIM_PRODUCT              | product_id             | 1:1 Mapping via join on stg.product_id                                  |
| FACT_EXECUTIVE_SUMMARY   | a120_amount            | STG_HOLDING_METRICS      | a120_amount            | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | a120_count             | STG_HOLDING_METRICS      | a120_count             | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | a30_to_59_amount       | STG_HOLDING_METRICS      | a30_to_59_amount       | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | a30_to_59_count        | STG_HOLDING_METRICS      | a30_to_59_count        | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | a60_to_89_amount       | STG_HOLDING_METRICS      | a60_to_89_amount       | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | a60_to_89_count        | STG_HOLDING_METRICS      | a60_to_89_count        | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | a90_to_119_amount      | STG_HOLDING_METRICS      | a90_to_119_amount      | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | a90_to_119_count       | STG_HOLDING_METRICS      | a90_to_119_count       | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | charge_off_amount      | STG_HOLDING_METRICS      | charge_off_amount      | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | charge_off_count       | STG_HOLDING_METRICS      | charge_off_count       | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | fraud_amount           | STG_HOLDING_METRICS      | fraud_amount           | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | fraud_count            | STG_HOLDING_METRICS      | fraud_count            | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | income_amount          | STG_HOLDING_METRICS      | income_amount          | Transformation: If NULL or <0, set to 0; else, use value               |
| FACT_EXECUTIVE_SUMMARY   | number_of_accounts     | STG_HOLDING_METRICS      | number_of_accounts     | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | purchases_amount       | STG_HOLDING_METRICS      | purchases_amount       | 1:1 Mapping                                                            |
| FACT_EXECUTIVE_SUMMARY   | purchases_count        | STG_HOLDING_METRICS      | purchases_count        | 1:1 Mapping                                                            |

---

## 5. Transformation Logic

- **income_amount:**  
  `CASE WHEN stg.income_amount IS NULL OR stg.income_amount < 0 THEN 0 ELSE stg.income_amount END`  
  *Ensures that income amount is always non-negative and not null.*

- **Referential Integrity:**  
  Joins to dimension tables (`DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`) ensure only valid, related records are inserted.

- **Audit Logging:**  
  Captures the number of inserted records for monitoring and troubleshooting.

- **Temporary Table Usage:**  
  Staging data is isolated in a temp table for transformation and validation before final insertion.

- **No UDFs or reusable templates** are used in this procedure.

---

## 6. Complexity Analysis

| Metric                                 | Value / Description                                       |
|-----------------------------------------|-----------------------------------------------------------|
| Number of Pipeline Activities           | 1 (Stored Procedure)                                      |
| Number of Dataflow Transformations      | 1 (SQL-based transformation with joins and CASE logic)    |
| SQL Scripts or Stored Procedures Used   | 1                                                        |
| Joins Used                             | 4 (INNER JOINs to dimension tables)                       |
| Lookup Tables or Reference Data         | 4 (DIM_DATE, DIM_INSTITUTION, DIM_CORPORATION, DIM_PRODUCT)|
| Parameters/Variables/Triggers          | 2 local variables (row count, error message); no triggers |
| Number of Output Datasets              | 1 (FACT_EXECUTIVE_SUMMARY)                               |
| Conditional Logic or if-else Flows     | 1 (CASE for income_amount)                                |
| External Dependencies                  | Staging and dimension tables in Synapse DW                |
| Overall Complexity Score                | 25 (Low to Moderate; simple logic, standard joins)        |

---

## 7. Key Outputs

- **Output Table:** `FACT_EXECUTIVE_SUMMARY`
- **Format:** Synapse DW Table (columnar storage, optimized for analytics)
- **Intended Use:**  
  - Executive dashboards and reporting  
  - Regulatory and compliance analytics  
  - Downstream data marts and business intelligence  
- **Output Content:**  
  Summarized, validated holding metrics by date, institution, corporation, and product, with business rules enforced.

---

## API Cost

apiCost: 0.0025 USD

---