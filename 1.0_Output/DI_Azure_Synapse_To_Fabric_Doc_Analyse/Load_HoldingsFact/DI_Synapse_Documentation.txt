```
# Azure Synapse Documentation: Executive Summary Fact Load

---
**Author:** Ascendion AAVA  
**Date:**  
**Description:** Loads the FACT_EXECUTIVE_SUMMARY table with summarized holding metrics from staging, applying business rules and ensuring referential integrity.
---

## 1. Overview of Pipeline/Component

The `dbo.LOAD_FACT_EXECUTIVE_SUMMARY` stored procedure in Azure Synapse Analytics is designed to populate the `FACT_EXECUTIVE_SUMMARY` fact table with aggregated holding metrics. It sources data from the `STG_HOLDING_METRICS` staging table, applies data quality checks and business rules, and ensures referential integrity by joining to dimension tables. This process supports executive reporting, regulatory compliance, and downstream analytics by providing a cleansed and validated summary of holdings data.

## 2. Component Structure and Design

- **Source:**  
  - `dbo.STG_HOLDING_METRICS` (staging table for holding metrics)
- **Key Activities:**  
  - Data extraction from staging into a temp table (`#staging_metrics`)
  - Data validation and transformation (e.g., handling null/negative income)
  - Joins to dimension tables: `DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`
  - Insertion into `FACT_EXECUTIVE_SUMMARY`
  - Audit logging (row counts)
  - Cleanup of temp resources
- **Orchestration:**  
  - This stored procedure would typically be invoked by a Synapse pipeline activity (e.g., "Stored Procedure Activity"), possibly parameterized and scheduled via triggers.
- **Parameters/Variables:**  
  - Internal variables for row count and error messages.
- **Triggers:**  
  - Not explicitly defined here, but likely scheduled or event-based in the pipeline.

## 3. Data Flow and Processing Logic

- **Key Data Sources:**  
  - `dbo.STG_HOLDING_METRICS` (staging)
  - Dimension tables: `DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`
- **Staging/Intermediate:**  
  - `#staging_metrics` (temp table)
- **Final Output:**  
  - `FACT_EXECUTIVE_SUMMARY` (fact table)

**Logical Steps:**
1. **Extract:** Copy all records from `STG_HOLDING_METRICS` into `#staging_metrics`.
2. **Transform & Validate:**  
   - Join with dimension tables to ensure referential integrity.
   - Apply business rules (e.g., set `income_amount` to 0 if null or negative).
3. **Load:** Insert validated and joined data into `FACT_EXECUTIVE_SUMMARY`.
4. **Audit:** Log the number of inserted records.
5. **Cleanup:** Drop the temp table.

**Business Rules/Transformations:**
- `income_amount` is set to 0 if null or negative.
- Only records with valid dimension keys are loaded.

## 4. Data Mapping (Lineage)

| Target Table Name        | Target Column Name     | Source Table Name         | Source Column Name     | Remarks                                               |
|-------------------------|-----------------------|--------------------------|-----------------------|-------------------------------------------------------|
| FACT_EXECUTIVE_SUMMARY  | date_key              | DIM_DATE                 | date_key              | 1:1 Mapping via join on stg.date_value                |
| FACT_EXECUTIVE_SUMMARY  | institution_id        | DIM_INSTITUTION          | institution_id        | 1:1 Mapping via join on stg.institution_id            |
| FACT_EXECUTIVE_SUMMARY  | corporation_id        | DIM_CORPORATION          | corporation_id        | 1:1 Mapping via join on stg.corporation_id            |
| FACT_EXECUTIVE_SUMMARY  | product_id            | DIM_PRODUCT              | product_id            | 1:1 Mapping via join on stg.product_id                |
| FACT_EXECUTIVE_SUMMARY  | a120_amount           | STG_HOLDING_METRICS      | a120_amount           | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | a120_count            | STG_HOLDING_METRICS      | a120_count            | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | a30_to_59_amount      | STG_HOLDING_METRICS      | a30_to_59_amount      | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | a30_to_59_count       | STG_HOLDING_METRICS      | a30_to_59_count       | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | a60_to_89_amount      | STG_HOLDING_METRICS      | a60_to_89_amount      | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | a60_to_89_count       | STG_HOLDING_METRICS      | a60_to_89_count       | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | a90_to_119_amount     | STG_HOLDING_METRICS      | a90_to_119_amount     | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | a90_to_119_count      | STG_HOLDING_METRICS      | a90_to_119_count      | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | charge_off_amount     | STG_HOLDING_METRICS      | charge_off_amount     | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | charge_off_count      | STG_HOLDING_METRICS      | charge_off_count      | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | fraud_amount          | STG_HOLDING_METRICS      | fraud_amount          | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | fraud_count           | STG_HOLDING_METRICS      | fraud_count           | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | income_amount         | STG_HOLDING_METRICS      | income_amount         | Transformation: set to 0 if null or < 0              |
| FACT_EXECUTIVE_SUMMARY  | number_of_accounts    | STG_HOLDING_METRICS      | number_of_accounts    | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | purchases_amount      | STG_HOLDING_METRICS      | purchases_amount      | Direct mapping                                        |
| FACT_EXECUTIVE_SUMMARY  | purchases_count       | STG_HOLDING_METRICS      | purchases_count       | Direct mapping                                        |

## 5. Transformation Logic

- **income_amount:**  
  - `CASE WHEN stg.income_amount IS NULL OR stg.income_amount < 0 THEN 0 ELSE stg.income_amount END`
  - Ensures no null or negative values for income.
- **Joins:**  
  - Only records with matching keys in all dimension tables are loaded (inner joins).
- **No UDFs or reusable templates** are used in this stored procedure.

## 6. Complexity Analysis

| Metric                          | Value/Details                                      |
|----------------------------------|----------------------------------------------------|
| Number of Pipeline Activities    | 1 (Stored Procedure, typically 1 pipeline activity)|
| Number of Dataflow Transformations| 1 (in-proc transformation via SQL CASE)           |
| SQL Scripts or Stored Procedures Used | 1 (this procedure)                         |
| Joins Used                      | 4 (all INNER JOINs to dimension tables)            |
| Lookup Tables or Reference Data  | 4 (dimension tables)                               |
| Parameters/Variables/Triggers    | 2 variables, 0 parameters, 0 triggers (in script)  |
| Number of Output Datasets        | 1 (`FACT_EXECUTIVE_SUMMARY`)                       |
| Conditional Logic or if-else Flows| 1 (CASE for income_amount)                        |
| External Dependencies            | Dimension tables (`DIM_DATE`, `DIM_INSTITUTION`, `DIM_CORPORATION`, `DIM_PRODUCT`) |
| Overall Complexity Score         | 35                                                |

## 7. Key Outputs

- **Table:** `FACT_EXECUTIVE_SUMMARY`
- **Format:** Azure Synapse Table (columnar storage, suitable for analytics)
- **Intended Use:** Executive dashboards, regulatory reporting, downstream analytics, and business intelligence.

---

## API Cost

apiCost: 0.004 USD

```