=============================================
Author:  Ascendion AAVA
Date:          
Description:  Fabric Cost and Testing Effort Estimator for Synapse to Fabric Conversion
=============================================

---

### 1. Cost Estimation

#### 1.1 Fabric Runtime Cost

Based on the analysis of the `dbo.LOAD_FACT_EXECUTIVE_SUMMARY` stored procedure, the estimated Fabric runtime cost breakdown is as follows:

**Estimated Monthly Runtime Cost: $125 - $185 USD**

**Cost Justification:**
- **Complexity Assessment**: The procedure has a complexity score of 35/100, indicating moderate complexity with 4 inner joins, 1 temporary table, and basic data transformations
- **Data Volume Considerations**: Processing staging table `STG_HOLDING_METRICS` with joins to 4 dimension tables (DIM_DATE, DIM_INSTITUTION, DIM_CORPORATION, DIM_PRODUCT)
- **Execution Frequency**: Assuming daily execution for executive reporting requirements
- **Fabric Compute Units**: Estimated 2-3 compute units per execution based on join complexity and data volume
- **Performance Optimizations**: Fabric's columnar storage and optimized join algorithms should provide 15-20% performance improvement over Synapse

**Detailed Cost Breakdown:**
- Spark Compute (per execution): $3.50 - $5.25
- Storage I/O operations: $0.75 - $1.10
- Data movement between tables: $0.25 - $0.40
- Monthly total (30 executions): $125 - $185

---

### 2. Code Fixing and Testing Effort Estimation

#### 2.1 Fabric Code Manual Fixes 

**Estimated Manual Fix Effort: 16-20 hours**

**Effort Breakdown by Component:**

**Synapse Lookups (4 hours):**
- Converting 4 INNER JOIN operations to Fabric DataFrame joins
- Implementing proper broadcast join strategies for dimension tables
- Validating referential integrity constraints

**Joins (6 hours):**
- Refactoring complex multi-table joins from T-SQL to Spark SQL
- Optimizing join order and predicate pushdown
- Testing join performance and result accuracy

**Aggregations (2 hours):**
- Converting row count operations from @@ROWCOUNT to DataFrame count methods
- Implementing audit logging mechanisms

**Conditional Expressions (4-6 hours):**
- Converting CASE statement for income_amount validation to Fabric code
- Implementing business rule logic: `CASE WHEN stg.income_amount IS NULL OR stg.income_amount < 0 THEN 0 ELSE stg.income_amount END`
- Testing edge cases and null handling

**Additional Manual Fixes:**
- Temporary table conversion to DataFrame operations (2 hours)
- Variable declaration replacement with parameters (1 hour)
- Error handling and logging implementation (1 hour)

#### 2.2 Output Validation Effort

**Estimated Validation Effort: 12-16 hours**

**Validation Components:**

**Data Reconciliation (8-10 hours):**
- Row count validation between Synapse and Fabric outputs
- Field-by-field data comparison for all 15 mapped columns
- Statistical analysis of numerical fields (amounts and counts)
- Validation of business rule application (income_amount transformation)

**Schema and Data Type Validation (2-3 hours):**
- Confirming data type consistency across platforms
- Validating precision and scale for numerical fields
- Testing date format consistency

**Performance Validation (2-3 hours):**
- Execution time comparison between Synapse and Fabric
- Resource utilization analysis
- Scalability testing with varying data volumes

#### 2.3 Total Estimated Effort in Hours

**Total Estimated Effort: 28-36 hours**

**Calculation Justification:**
- Manual Code Fixes: 16-20 hours
- Output Validation: 12-16 hours
- Total Range: 28-36 hours

**Effort Calculation Rationale:**
The total effort accounts for the moderate complexity (35/100) of the stored procedure, with significant time allocated to join optimization and validation due to the multi-dimensional nature of the fact table loading process. The range accounts for potential complexity variations and the need for thorough testing of financial data accuracy.

**Risk Factors Considered:**
- Multiple dimension table dependencies requiring careful validation
- Business rule complexity for income amount handling
- Executive reporting criticality requiring extensive testing
- Potential performance tuning iterations

---

### 3. API Cost Consumption

```
apiCost: 0.0523 USD
```