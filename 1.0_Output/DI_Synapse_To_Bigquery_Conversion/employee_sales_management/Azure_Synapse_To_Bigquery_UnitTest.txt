================================
Author: AAVA
Created on:   
Description: Load Sales Fact - Unit tests and Pytest script for BigQuery implementation of sales fact loading, including audit logging, data quality checks, transformation, and error handling.
================================

Test Case List:

| Test Case ID | Description                                                                 | Expected Outcome                                                                                           |
|--------------|-----------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------|
| TC01         | Happy path: All staging rows valid, all are loaded to fact                  | All rows inserted into Fact_Sales; Audit_Log and DQ_Failures updated correctly; staging table truncated    |
| TC02         | Missing Customer_ID in some rows                                            | Rows with NULL Customer_ID rejected, logged in DQ_Failures, not loaded to Fact_Sales                      |
| TC03         | Quantity <= 0 in some rows                                                  | Rows with Quantity <= 0 rejected, logged in DQ_Failures, not loaded to Fact_Sales                         |
| TC04         | Both Customer_ID NULL and Quantity <= 0 in same row                         | Row rejected with both reasons, appears once in DQ_Failures with one reason (first match in union)        |
| TC05         | All staging rows invalid                                                    | No rows loaded to Fact_Sales, all rejected rows logged in DQ_Failures, Audit_Log shows 0 inserted         |
| TC06         | Empty staging table                                                         | No rows loaded or rejected, Audit_Log shows 0 inserted and 0 rejected                                     |
| TC07         | Join failure: Customer_ID in staging not found in Dim_Customer              | Row not loaded to Fact_Sales, not rejected as DQ failure, not present in DQ_Failures                      |
| TC08         | Join failure: Sales_Date not found in Dim_Date                              | Row not loaded to Fact_Sales, not rejected as DQ failure, not present in DQ_Failures                      |
| TC09         | Invalid data types in staging (e.g., string in Quantity)                    | Script fails, Audit_Log updated with FAILED status and error message                                       |
| TC10         | Missing required columns in staging table                                   | Script fails, Audit_Log updated with FAILED status and error message                                       |

(Pytest script as above)

apiCost: 0.0023 USD