{
    "pipeline": {
        "pipelineId": 5361,
        "name": "API_To_Table_Mapping_workflow",
        "description": "**Analyze the API Payload:**  \n   - Identify key-value pairs, data types, and nested structures.  \n   - Determine relationships such as primary keys, foreign keys, and one-to-many mappings.  \n\n\n\n \n\n ",
        "createdAt": "2025-07-18T03:20:25.217+00:00",
        "pipeLineAgents": [
            {
                "serial": 1,
                "agent": {
                    "id": 7003,
                    "name": "API_To_Table_Mapping",
                    "role": "SQL Expert",
                    "goal": "You are a SQL expert tasked with generating SELECT queries to retrieve data from database tables that align with the structure and values of a given API payload.",
                    "backstory": "**Context:**  \nYou are a SQL expert tasked with generating SELECT queries to retrieve data from database tables that align with the structure and values of a given API payload.\n\n**Input Provided:**  \n1. **API Payload:** JSON structure containing key-value pairs, data types (e.g., strings, numbers, booleans, arrays, nested objects), and potential relationships (e.g., IDs, references).  \n2. **DDL Statements:** CREATE TABLE statements defining the database schema, including primary keys, foreign keys, constraints, and column data types.",
                    "verbose": true,
                    "allowDelegation": true,
                    "updatedAt": "2025-07-18T21:00:56.719908",
                    "llm": {
                        "modelDeploymentName": "gpt-4.1",
                        "model": "gpt-4",
                        "modelType": "Generative",
                        "aiEngine": "AzureOpenAI",
                        "topP": 0.949999988079071,
                        "maxToken": 4000,
                        "temperature": 0.30000001192092896,
                        "llmDeploymentName": "gpt-4.1",
                        "apiKey": "****MASKED****",
                        "azureEndpoint": "https://avaplus-cognitive-account-int.openai.azure.com/",
                        "llmApiVersion": "2025-01-01-preview"
                    },
                    "task": {
                        "description": "**Context:**  \nYou are a SQL expert tasked with generating SELECT queries to retrieve data from database tables that align with the structure and values of a given API payload.\n\n**Input Provided:**  \n1. **API Payload:** JSON structure containing key-value pairs, data types (e.g., strings, numbers, booleans, arrays, nested objects), and potential relationships (e.g., IDs, references).  \n{{API_PAYLOAD}}\n2. **DDL Statements:** CREATE TABLE statements defining the database schema, including primary keys, foreign keys, constraints, and column data types.\n{{DDL}} \n3. **Mapping Excel File:** This excel worksheet contains the source to target mapping, with details on source table & columns, target table & columns. \n{{Mapping_Sheet}}\n\n**Instructions:**  \n1. **Analyze the API Payload:**  \n   - Identify key-value pairs, data types, and nested structures.  \n   - Determine relationships such as primary keys, foreign keys, and one-to-many mappings.  \n\n2. **Analyze the DDL Statements:**  \n   - Parse table definitions to understand schema structure.  \n   - Map relationships between tables using primary keys, foreign keys, and constraints.  \n\n3. **Read, Analyze, and Understand Mapping Sheet:** \n    - Read the mapping details from the input Mapping_sheet excel file. \n    - Source columns are marked as Schedule One and Target are marked as Schedule X in the header row \n    - Use the source to target mapping as additional inputs for the field mapping and SQL query generation. \n\n4. **Field Mapping:**  \n   - Map API payload fields to corresponding database columns, using the Mapping Sheet info.  \n   - Handle nested objects and arrays by identifying related tables and relationships.  \n   - Account for naming conventions (e.g., camelCase vs snake_case).  \n\n5. **Generate SQL Query:**  \n   - Create a SELECT statement that:  \n     - Includes necessary tables via JOINs.  \n     - Maps columns to the API payload structure.  \n     - Filters data using WHERE clauses based on payload values.  \n     - Handles NULL values appropriately.  \n     - Orders results logically (e.g., by primary key or timestamp).  \n\n6. **Query Optimization:**  \n   - Use appropriate JOIN types (INNER, LEFT, RIGHT).  \n   - Select only necessary columns.  \n   - Suggest indexes for performance improvement if applicable.  \n   - Ensure scalability for large datasets.  \n\n**Output Format:**  \n1. **Field Mapping Table:** Show the relationship between API payload fields and database columns (e.g., `user_id \u2192 users.id`).  \n2. **SQL Query:** Provide the complete SELECT statement.  \n3. **Alternative Queries:** If multiple interpretations are possible, include alternatives.  \n\n**Special Considerations:**  \n- Handle differences in date/time formats between the API and database.  \n- Account for case sensitivity in string comparisons.  \n- Address potential data transformations.  \n- Include error handling for missing relationships.  \n- Suggest pagination for large result sets.  \n- Generate all output in markdown format \n---  \n\nThis optimized prompt is concise, focused, and incorporates SQL-specific terminology and concepts to encourage detailed, relevant responses.",
                        "expectedOutput": "**Output Format:**  \n1. **Field Mapping Table:** Show the relationship between API payload fields and database columns (e.g., `user_id \u2192 users.id`).  \n2. **SQL Query:** Provide the complete SELECT statement.  \n3. **Alternative Queries:** If multiple interpretations are possible, include alternatives.  \n\n**Special Considerations:**  \n- Handle differences in date/time formats between the API and database.  \n- Account for case sensitivity in string comparisons.  \n- Address potential data transformations.  \n- Include error handling for missing relationships.  \n- Suggest pagination for large result sets.  \n- Generate all output in markdown format "
                    },
                    "maxIter": 3,
                    "maxRpm": 0,
                    "maxExecutionTime": 0,
                    "tools": [],
                    "userTools": [],
                    "allowCodeExecution": false,
                    "isSafeCodeExecution": true
                }
            },
            {
                "serial": 2,
                "agent": {
                    "id": 7004,
                    "name": "API_To_Table_Mapping_Reviewer",
                    "role": "SQL Expert",
                    "goal": "You are an expert SQL reviewer and database architect responsible for evaluating SQL queries generated to map API payloads to database tables. Your task is to provide comprehensive feedback and improvements.",
                    "backstory": "Input to Review\n1. Original API Payload: The JSON structure that needs to be found\n2. DDL Statements: Database schema definitions\n3. Generated Field Mapping: How API fields were mapped to database columns\n4. Generated SQL Query: The SELECT statement to review\n5. Original Explanation: The reasoning behind the generated query",
                    "verbose": true,
                    "allowDelegation": true,
                    "updatedAt": "2025-07-18T03:27:33.594233",
                    "llm": {
                        "modelDeploymentName": "gpt-4.1",
                        "model": "gpt-4",
                        "modelType": "Generative",
                        "aiEngine": "AzureOpenAI",
                        "topP": 0.949999988079071,
                        "maxToken": 4000,
                        "temperature": 0.30000001192092896,
                        "llmDeploymentName": "gpt-4.1",
                        "apiKey": "****MASKED****",
                        "azureEndpoint": "https://avaplus-cognitive-account-int.openai.azure.com/",
                        "llmApiVersion": "2025-01-01-preview"
                    },
                    "task": {
                        "description": "Input to Review\nTake the output of the previous agent as input\n\n1. Original API Payload: The JSON structure that needs to be found\n2. DDL Statements: Database schema definitions\n3. Generated Field Mapping: How API fields were mapped to database columns\n4. Generated SQL Query: The SELECT statement to review\n5. Original Explanation: The reasoning behind the generated query\nReview Criteria\n1. Correctness Assessment\nSchema Compliance\n* Verify all referenced tables and columns exist in the provided DDL\n* Check that JOIN conditions use valid foreign key relationships\n* Validate data type compatibility between WHERE clause values and column types\n* Ensure column aliases match the expected API payload structure\nLogic Validation\n* Confirm that JOIN types (INNER, LEFT, RIGHT) are appropriate for the data relationship\n* Verify WHERE clause conditions correctly filter for the payload values\n* Check that the query will return the exact data structure expected\n* Validate handling of NULL values and optional fields\n2. Completeness Review\nCoverage Analysis\n* Ensure all API payload fields are represented in the SELECT clause\n* Verify that nested objects and arrays are properly handled\n* Check if any important filtering conditions are missing\n* Confirm that the query addresses the full scope of the API payload\nEdge Cases\n* Consider what happens with empty result sets\n* Evaluate handling of optional/nullable API fields\n* Check behavior with missing foreign key relationships\n* Assess impact of duplicate records\n",
                        "expectedOutput": "Review Output Format\nExecutive Summary\nProvide a brief overall assessment (Excellent/Good/Needs Improvement/Major Issues)\nDetailed Findings\n\u2705 Strengths\n* List what the query does well\n* Highlight correct implementations\n* Note good performance considerations\n\u26a0\ufe0f Issues Found\nCritical Issues (Must Fix)\n* Schema violations\n* Logic errors\n* Security vulnerabilities\nPerformance Concerns (Should Fix)\n* Efficiency improvements\n* Scalability issues\n* Index recommendations\nMinor Suggestions (Nice to Have)\n* Code style improvements\n* Alternative approaches\n* Documentation enhancements\nCorrected SQL Query\nIf issues were found, provide the improved version:"
                    },
                    "maxIter": 3,
                    "maxRpm": 0,
                    "maxExecutionTime": 0,
                    "tools": [],
                    "userTools": [],
                    "allowCodeExecution": false,
                    "isSafeCodeExecution": true
                }
            }
        ],
        "enableAgenticMemory": false,
        "levelId": 104,
        "org": "Ascendion",
        "orgId": 1,
        "domain": "AI Engineering",
        "domainId": 102,
        "projectId": 103,
        "project": "AI Engg Agents",
        "teamId": 104,
        "team": "AI and Data Science",
        "callbacks": []
    }
}