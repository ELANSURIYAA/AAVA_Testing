{
    "pipeline": {
        "pipelineId": 9691,
        "name": "DI_Azure_Sql_Server_Read_table",
        "description": "Read and extract the schema",
        "createdAt": "2025-12-03T13:10:41.834+00:00",
        "pipeLineAgents": [
            {
                "serial": 1,
                "agent": {
                    "id": 12777,
                    "name": "DI_Azure_Sql_Server_Read_table",
                    "role": "Senior Software Engineer",
                    "goal": "Read and extract the schema of an Azure SQL Server database.",
                    "backstory": "Understanding the schema of an Azure SQL Server database is critical for tasks such as database optimization, migration, integration, and application development. A clear schema provides insights into the structure of the database, including tables, columns, data types, relationships, and constraints, which are essential for making informed decisions and ensuring seamless operations.",
                    "verbose": true,
                    "allowDelegation": true,
                    "updatedAt": "2025-12-24T04:30:32.210689",
                    "llm": {
                        "modelDeploymentName": "gpt-5",
                        "model": "gpt-5",
                        "modelType": "Generative",
                        "aiEngine": "AzureOpenAI",
                        "topP": 0.949999988079071,
                        "maxToken": 8000,
                        "temperature": 0.30000001192092896,
                        "llmDeploymentName": "gpt-5",
                        "apiKey": "****MASKED****",
                        "azureEndpoint": "https://avaplus-cognitive-account-int.openai.azure.com/",
                        "llmApiVersion": "2024-12-01-preview"
                    },
                    "task": {
                        "description": "As a Senior Software Engineer, your task is to read and extract the schema of an Azure SQL Server database. Follow these detailed instructions to achieve the goal:\nINSTRUCTIONS:\n1. Establish a connection to the Azure SQL Server database using appropriate credentials and connection strings.\n2. Query the system catalog views or metadata tables to retrieve schema information. Focus on the following details:\n   - List of all tables and their respective schemas.\n   - Columns for each table, including column names, data types, nullability, and default values.\n   - Primary keys, foreign keys, and unique constraints for each table.\n   - Indexes and their associated columns.\n   - Relationships between tables (foreign key mappings).\n   - Views and their definitions.\n   - Stored procedures and their parameters.\n4. Use escaped newlines (\\n) for multi-line strings, such as view definitions or stored procedure details.\ninput\n{{schema_sql}}\n",
                        "expectedOutput": "SELECT \n    TABLE_SCHEMA,\n    TABLE_NAME\nFROM INFORMATION_SCHEMA.TABLES\nWHERE TABLE_TYPE = 'BASE TABLE'\nORDER BY TABLE_SCHEMA, TABLE_NAME;"
                    },
                    "maxIter": 30,
                    "maxRpm": 0,
                    "maxExecutionTime": 80,
                    "tools": [],
                    "userTools": [
                        {
                            "toolId": 1308,
                            "toolName": "Azure SQL Database Connector latest",
                            "toolClassName": "AzureSQLDatabaseConnector",
                            "toolClassDef": "import pymssql\nfrom typing import Any, Type\nfrom pydantic import BaseModel, Field\nfrom crewai.tools import BaseTool\nimport AVASecret\n\n\nclass AzureSQLDatabaseConnectorSchema(BaseModel):\n    '''Input schema for AzureSQLDatabaseConnector.'''\n    server: str = Field(..., description=\"The server name or IP address of the Azure SQL Database.\")\n    database: str = Field(..., description=\"The name of the database to connect to.\")\n    username: str = Field(..., description=\"The username for authenticating with the database.\")\n    password: str = Field(..., description=\"The password for authenticating with the database. This should be securely stored and retrieved.\")\n\n\nclass AzureSQLDatabaseConnector(BaseTool):\n    '''\n    AzureSQLDatabaseConnector - A tool to connect to an Azure SQL Database and retrieve INFORMATION_SCHEMA.TABLES.\n    '''\n\n    name: str = \"Azure SQL Database Connector\"\n    description: str = \"A tool to connect to an Azure SQL Database and retrieve INFORMATION_SCHEMA.TABLES.\"\n    args_schema: Type[BaseModel] = AzureSQLDatabaseConnectorSchema\n\n    def _run(self, server: str, database: str, username: str, password: str) -> str:\n        try:\n            print(f\"Connecting to Azure SQL Database: {server}, Database: {database}\")\n\n            # Establishing connection to the database\n            conn = pymssql.connect(\n                server=server,\n                user=username,\n                password=password,\n                database=database\n            )\n\n            cursor = conn.cursor()\n\n            # Query to retrieve INFORMATION_SCHEMA.TABLES\n            query = \"SELECT * FROM INFORMATION_SCHEMA.TABLES\"\n            cursor.execute(query)\n\n            # Fetching all rows from the query result\n            tables = cursor.fetchall()\n\n            # Closing the connection\n            conn.close()\n\n            return f\"Successfully connected to the database and retrieved tables: {tables}\"\n\n        except pymssql.InterfaceError as e:\n            return f\"Database connection error: {str(e)}\"\n        except pymssql.DatabaseError as e:\n            return f\"Database operation error: {str(e)}\"\n        except Exception as e:\n            return f\"An unexpected error occurred: {str(e)}\"",
                            "isApproved": false
                        }
                    ],
                    "allowCodeExecution": false,
                    "isSafeCodeExecution": true
                }
            }
        ],
        "enableAgenticMemory": false,
        "levelId": 99,
        "org": "Ascendion",
        "orgId": 1,
        "domain": "Data&Insights",
        "domainId": 96,
        "projectId": 98,
        "project": "AllProjects",
        "teamId": 99,
        "team": "AVA Team",
        "callbacks": []
    }
}