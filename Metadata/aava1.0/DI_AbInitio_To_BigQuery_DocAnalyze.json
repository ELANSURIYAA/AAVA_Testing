{
    "workflowId": 2733,
    "workflowName": "DI_AbInitio_To_BigQuery_Doc&Analyze",
    "nodes": [
        {
            "agentName": "DI_AbInitio_Documentation",
            "model": "anthropic.claude-4-sonnet",
            "tools": [],
            "task": {
                "description": "The documentation should include the following sections:\n\n- Format: Markdown\n- Add the following metadata at the top of each generated file:\n====================================================\nAuthor:        AAVA\nDate:          \nDescription:   <one-line description of the purpose>\n====================================================\n\n1. Overview of Graph/Component\n   - Describe the purpose of the Ab Initio graph (.mp), transformation (.xfr), data definition (.dml), plan (.plan), or pset (.pset).\n   - Explain the business logic or requirement the graph or component addresses.\n\n2. Component Structure and Design\n   - Describe the layout and logical grouping of components inside the graph or plan.\n   - Highlight key components such as Input File, Reformat, Join, Sort, Dedup, Rollup, Output File, Run Program, and others.\n   - Mention the connection flow between components and the use of parameters or variables.\n\n3. Data Flow and Processing Logic\n   - List the key data sources, intermediate files, and final outputs.\n   - For each logical step:\n     - Describe what it does (filtering, joining, reformatting, aggregation, etc.).\n     - Mention any .xfr or .dml files used.\n     - Include any business rules or transformations applied.\n\n4. Data Mapping (Lineage)\n   - Map fields from input datasets to output datasets.\n   - ***IMPORTANT: The Data Mapping must be generated in TABLE format.***\n   - The table should have the following columns:\n     | Target Table | Target Column | Source Table | Source Column | Remarks |\n   - Remarks should include: 1:1 Mapping | Transformation | Validation (with logic description).\n\n5. Transformation Logic\n   - Document each .xfr function used or called in the flow.\n   - Explain what each function does and what fields are involved.\n   - Note any external function calls or reusable components.\n\n6. Complexity Analysis\n   - Number of Graph Components: <integer>\n   - Number of Lines of Code (in .xfr or .plan): <integer>\n   - Transform Functions Used: <count>\n   - Joins Used: <list of types or None>\n   - Lookup Files or Datasets: <count or None>\n   - Parameter Sets (.pset) or Plan Files Used: <count>\n   - Number of Output Datasets: <integer>\n   - Conditional Logic or if-else flows: <count>\n   - External Dependencies: <JDBC, shell scripts, other tools>\n   - Overall Complexity Score: <0\u2013100>\n\n7. Key Outputs\n   - Describe what is written to final datasets or passed to the next stages.\n   - Mention the format (Delimited, Fixed Width, etc.) and intended use (report, downstream system).\n\n8. Error Handling and Logging\n   - Document any Reject, Error, or Log components used.\n   - Mention .xfr-based error tagging, reject thresholds, or control file usage.\n   - Describe how errors are handled (auto-abort, reject files, alerting, etc.).\n\n9. API Cost (LLM Cost ONLY)\n   - ***You must calculate and print ONLY the LLM API cost consumed for THIS PARTICULAR CALL.***\n   - Do NOT calculate any job-related cost or cloud compute cost.\n   - The cost must be based purely on tokens used in this API call.\n   - Output format:\n     - Tokens Used (Prompt + Completion)\n     - Cost per 1K tokens\n     - Final Cost in USD for this single documentation run\n\nInput:\nAttach or provide the Ab Initio files (.mp, .xfr, .dml, .plan, .pset). Acceptable formats: plain text, zipped folder, or directory path structure: {{AbInitio_Code}}\n",
                "expectedOutput": "The generated Markdown documentation should include the following, based on the input Ab Initio code:\n- **Format:** Markdown  \n- Metadata Requirements: \"<as above>\"  \n- Overview of Program: \"<3\u20135 line description explaining business purpose>\"  \n- Code Structure and Design: \"<Detailed explanation of component layout and connection>\"  \n- Data Flow and Processing Logic:  \n  - Processed Datasets: [\"<list all dataset names>\"]  \n  - Data Flow: \"<Description of end-to-end data journey>\"  \n- Data Mapping:  \n  - Target Table Name: \"<value>\"  \n  - Target Column Name: \"<value>\"  \n  - Source Table Name: \"<value>\"  \n  - Source Column Name: \"<value>\"  \n  - Remarks: \"<Mapping logic>\"  \n- Transformation Logic: \"<Documentation for each .xfr used>\"  \n- Complexity Analysis:  \n  - Components: <number>  \n  - Joins: <type/count>  \n  - Functions: <count>  \n  - Conditional Paths: <count>  \n  - External Dependencies: \"<list>\"  \n  - Score: <0\u2013100>  \n- Key Outputs: \"<Summary of outputs>\"  \n- Error Handling and Logging: \"<How errors are managed>\"  \n- API Cost: \"<With Proper calculation for call the ai model for this particular task>\""
            }
        },
        {
            "agentName": "DI_AbInitio_To_BigQuery_Analyzer",
            "model": "gemini-2.5-pro",
            "tools": [],
            "task": {
                "description": "This agent performs a **pre-conversion assessment** of Ab Initio code to evaluate readiness for BigQuery SQL migration. It will:\n- Break down ETL flow, transformation logic, and schema definitions.\n- Identify SQL-compatible and non-compatible elements (e.g., feedback loops, reject logic, record-level transformations).\n- Highlight areas needing manual rewriting or workaround logic in SQL.\n- Score the complexity of the conversion.\n- Recommend strategies for expressing complex logic as BigQuery SQL views, UDFs, or nested queries.\n- Suggest checkpoints for validation and data assurance post-migration.\n\n### **INSTRUCTIONS:**  \n\n1. **Process Steps to Follow:**  \n   - **Step 1:** Parse `.mp`, `.xfr`, `.dml` files. Identify key ETL steps and transformations.  \n   - **Step 2:** Highlight challenges in translating to SQL (e.g., multi-branch logic, reformatting, `.xfr` logic, procedural dependencies).  \n   - **Step 3:** Assign a conversion complexity score (0\u2013100) based on logic depth, metadata use, joins, and custom functions.  \n   - **Step 4:** Recommend SQL patterns (e.g., CTE chains, subqueries, temp tables, UDFs) to replicate logic.  \n   - **Step 5:** Identify where manual attention will be needed for performance tuning, logic validation, or syntax restructuring.\n\n### **Output Format:**  \nUse **Markdown formatting**. Include the following metadata header:\n```\n=======================================================================================\nAuthor:        Ascendion AVA+\nCreated on:    (Leave it empty)\nDescription:   Pre-conversion analysis of Ab Initio ETL flow for BigQuery SQL migration\n=======================================================================================\n```\n\n### **Sections to Include:**\n\n#### Syntax Differences:\n- Breakdown of major Ab Initio components (e.g., `Join`, `Reformat`, `Rollup`, `Broadcast`, `Filter`, `Output Table`).\n- Explain how each would map to BigQuery constructs (e.g., `JOIN`, `SELECT`, `ARRAY_AGG`, `WITH` clauses, `TEMP TABLES`, etc.).\n- Highlight incompatible or non-native SQL behaviors (e.g., reject ports, iterative components).\n\n#### Anticipated Manual Interventions:\n- Embedded `.xfr` logic needing translation to SQL expressions or UDFs.\n- `.dml` schemas requiring restructuring for SQL compatibility (e.g., record-level vs. column-level mapping).\n- Graph variables or parameter sets that require template handling in BigQuery (via scripting or external orchestration).\n- Handling of procedural constructs (e.g., conditional branching) through CTE chains or nested selects.\n\n#### Complexity Evaluation:\n- Score (0\u2013100)\n- Justify using:\n  - Number and variety of components\n  - Use of `.xfr` logic and nested expressions\n  - Depth of joins and data dependencies\n  - File types or complex formats requiring custom parsing\n  - Need for BigQuery UDFs or scripting blocks\n\n#### Optimization Recommendation:\n- **Refactor:** Mostly direct SQL mapping with moderate complexity.\n- **Rebuild:** Requires full redesign of transformation logic for BigQuery SQL compatibility.\n\n### **API Cost:**  \nReport API cost for this particular api call to the AI model:  \n`apiCost: <actual_cost> USD`\n\n### **Input:**  \n- Ab Initio Source Files: `{{AbInitio_Code}}`",
                "expectedOutput": "A structured Markdown report containing in-depth pre-conversion analysis of the Ab Initio ETL code for BigQuery SQL migration. It should surface translation complexities, logical gaps, manual intervention points, and SQL design suggestions to ensure smooth and accurate migration."
            }
        },
        {
            "agentName": "DI_AbInitio_To_BigQuery_Plan",
            "model": "gpt-4",
            "tools": [],
            "task": {
                "description": "You are tasked with reviewing the Ab Initio source files (e.g., `.mp`, `.xfr`, `.dml`, `.pset`) during conversion to BigQuery SQL. Your responsibilities include identifying logic gaps requiring manual SQL intervention, estimating developer/tester effort, and forecasting BigQuery query costs based on data volume and query characteristics.\n\n### **INSTRUCTIONS:**  \n1. Analyze the Ab Initio codebase and its SQL conversion implications:\n   - Focus on logic gaps (e.g., `.xfr` complexity, reject handling, branching).\n   - Exclude syntactic equivalents already handled by auto-conversion tools.\n\n2. Estimate developer/tester effort in hours for:\n   - Manual SQL rewrites (e.g., custom `.xfr` translation, conditional logic in SQL)\n   - Metadata alignment (schema transformation, data type mapping)\n   - Edge case handling (reject records, fallback branches)\n   - Data reconciliation and validation testing\n\n3. Estimate **BigQuery Query Cost** using:\n   - Expected data volume scanned per query (in GB)\n   - Number of queries per day/week/month\n   - BigQuery pricing model: e.g., `$5 per TB scanned`\n\n4. Calculate **Total Developer Cost** using a default hourly rate (e.g., $50/hr)\n\n5. Present cost metrics, effort estimation, and guidance in a structured format.\n\n### **OUTPUT FORMAT:**  \nUse **Markdown** format with the following metadata header:\n```\n==============================================================================\nAuthor:        Ascendion AVA+\nCreated on:    (Leave it empty)\nDescription:   Cost & effort planning for Ab Initio to BigQuery SQL conversion\n==============================================================================\n```\n\n#### 1. BigQuery Cost Estimation  \n##### 1.1 Query Cost Breakdown  \n- **Data Volume Estimate per Query**: `<estimated_gb>` GB  \n- **Query Frequency**: `<queries/day>`  \n- **Monthly Volume Scanned**: `<calculated>` GB  \n- **BigQuery Pricing Used**: `$5 per TB scanned`  \n- **Estimated Monthly Cost (USD)**: `<calculated_cost>`\n\n> *Cost Formula Used:*  \nMonthly Cost = (Total GB Scanned / 1024) \u00d7 $5\n\n#### 2. Manual Code Fixing and Data Reconciliation Effort  \n##### 2.1 Estimated Effort (Hours)  \n- SQL Logic Adjustments (e.g., `.xfr` logic, reformat rules): `<integer>` hrs  \n- Schema/Data Type Fixes (e.g., `.dml` mapping issues): `<integer>` hrs  \n- Reject Logic or Conditional Handling: `<integer>` hrs  \n- Output Validation & Reconciliation Testing: `<integer>` hrs  \n- **Total Estimated Effort**: `<sum>` hrs\n\n##### 2.2 Developer Cost  \n- Developer Hourly Rate: `$50/hr`  \n- **Total Developer Cost**: `<effort_hrs \u00d7 50>` USD\n\n#### 3. API Processing Cost  \n- `apiCost: <actual_cost>` USD\n\n\n### **Input:**  \n- Ab Initio Source File: `{{AbInitio_Code}}`  \n- GCP Environmental Variable details file: {{Env_Details}}",
                "expectedOutput": "A structured report that:\n- Projects BigQuery query cost per workload  \n- Estimates manual effort for accurate and complete SQL migration  \n- Calculates developer cost  \n- Provides API usage cost  \n- Serves as a planning baseline for migration teams and architects"
            }
        }
    ]
}